/**

MetaPlayer Framework  v3.2.20130313

A standards-based, multiple player, UI and Event framework for JavaScript.

Copyright (c) 2011 RAMP Holdings, Inc.

Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
*/
(function(){var d=window.jQuery,f=window.Popcorn,c={isTouchDevice:null,debug:"",layout:{},metadata:{},search:{},cues:{}},a=function(b,e){if(!(this instanceof a))return new a(b,e);this.config=d.extend({},c,e,a.script.query("^mp."));a.dispatcher(this);this._plugins={};this._loadQueue=[];this.target=b;this.isTouchDevice=null!=this.config.isTouchDevice?this.config.isTouchDevice:/iPad|iPhone|iPod/i.test(navigator.userAgent);if(this.config.metadata)this.metadata=new a.MetaData(this,this.config);if(this.config.search)this.search=
new a.Search(this,this.config);if(this.config.cues)this.cues=new a.Cues(this,this.config);this.video=this.adaptMedia(b);if(this.config.layout&&(this.video||"string"==typeof b))this.layout=a.layout(this.video||b,this.config.layout),this.config.maximize&&this.layout.maximize();var g=this;setTimeout(function(){g._load()},0)};a.DEBUG="error,warning";a.READY="ready";a.DESTROY="destroy";a.prototype={load:function(){this._load();return this},adaptMedia:function(b){var e,c=this;d.each(a.Players,function(a,
d){if(e=d(b,c))return!1});return e},destroy:function(){this.dispatcher.dispatch(a.DESTROY);delete this.plugins;delete this._loadQueue;delete this.layout;delete this.popcorn},_load:function(){if(!this._loaded){var b=this;this._loaded=!0;!this.video&&this.layout&&this.html5();if(null!=this.config.preload)this.video.preload=this.config.preload;if(this.video&&!this.popcorn&&null!=f)this.popcorn=f(this.video);if(this.video)this.playlist=new a.Playlist(this);this.video&&this.config.linkAdvance&&this.video.addEventListener("trackchange",
function(){var a=b.metadata.getData().link;if(a&&0<b.video.getIndex())window.top.location=a});for(var e;this._loadQueue.length;)e=this._loadQueue.shift(),e.fn.apply(this,e.args);this.ready=!0;this.dispatcher.dispatch(a.READY)}},error:function(a,e,c){var h=this.createEvent();h.initEvent("error",!1,!0);h.code=a;h.message=e;this.dispatchEvent(h);h=Array.prototype.slice.call(arguments);h.unshift("MPF");try{console.error(h.join(" :: "))}catch(d){}},warn:function(a,e){var c=this.createEvent();c.initEvent("warning",
!1,!0);c.code=a;c.message=e;this.dispatchEvent(c);c=Array.prototype.slice.call(arguments);c.unshift("MPF");try{console.warn(c.join(" :: "))}catch(h){}}};a.addPlugin=function(b,c){var g=a.prototype;if(g[b])throw"keyword unavailable: "+b;g[b]=function(){this.ready?c.apply(this,arguments):this._loadQueue.push({name:b,args:arguments,fn:c});return this}};a.addPlayer=function(b,c){var g=a.prototype;if(g[b])throw"keyword unavailable: "+b;g[b]=function(){c.apply(this,arguments);this.layout.addVideo(this.video);
return this}};a.iOS=/iPad|iPhone|iPod/i.test(navigator.userAgent);a.Core={};a.Services={};a.Players={};a.UI={};a.Util={};a.Metrics={};a.log=function(b,c){var g=Array.prototype.slice.call(arguments);if("string"==typeof a.DEBUG){var h=a.DEBUG.split(/[,\s]+/);a.DEBUG={};d.each(h,function(b,c){a.DEBUG[c]=!0})}if(a.DEBUG&&(!0==a.DEBUG||a.DEBUG[b])){g.unshift("MPF");try{console.log(g.join(" :: "))}catch(i){}}};window.MetaPlayer=a;window.MetaPlayerFramework=a;window.MPF=a})();
(function(){var d=jQuery,f={},c=function(a,b){this.config=d.extend({},f,b);MetaPlayer.dispatcher(this);this._cues={};this._rules={subtitle:{clone:"captions",enabled:!0}};this.player=a;this._addListeners()};MetaPlayer.Cues=c;c.CUES="cues";c.CLEAR="clear";c.RENDER="render";c.ENABLE="enable";c.DISABLE="disable";c.prototype={setCueLists:function(a,b){var c=this;d.each(a,function(a,h){c.setCues(a,h,b)})},getCueLists:function(a){return this._cues[a||this.player.metadata.getFocusUri()]},setCues:function(a,
b,c){var g=c||this.player.metadata.getFocusUri();this._cues[g]||(this._cues[g]={});this._cues[g][a]||(this._cues[g][a]=[]);this._cues[g][a]=b;d.each(b,function(a,b){if("string"==typeof b.start)b.start=parseFloat(b.start);if("string"==typeof b.end)b.start=parseFloat(b.end)});c==this.player.metadata.getFocusUri()&&this._renderCueType(a)},getCaptions:function(a){return this.getCues("captions",a)},getCues:function(a,b){var e=b||this.player.metadata.getFocusUri();if(!a)return this.getCueLists();if(this._rules[a]&&
this._rules[a].clone)a=this._rules[a].clone;return!this._cues[e]||!this._cues[e][a]?[]:this._cues[e][a].sort(c.cueSortFn)},enable:function(a,b,e){e=d.extend({},this._rules[a],e);if(!e.enabled)e.overrides=d.extend({},e.overrides,b),e.enabled=!0,this._rules[a]=e,b=this.createEvent(),b.initEvent(c.ENABLE,!1,!0),b.action=a,this.dispatchEvent(b),this._scheduleCues(a,this.getCues(e.clone||a))},disable:function(a){if(a){this._rules[a]||(this._rules[a]={});this._rules[a].enabled=!1;var b=this.createEvent();
b.initEvent(c.DISABLE,!1,!0);b.action=a;this.dispatchEvent(b);this._removeEvents(a)}},isEnabled:function(a){a=this._rules[a];return Boolean(a&&a.enabled)},destroy:function(){this._removeEvents();this.dispatcher.destroy();delete this.player},_renderCueType:function(a){var b=this.player.metadata.getFocusUri(),e=this.getCues(a,b);this._renderCues(a,e);this.event(c.CUES,{uri:b,plugin:a,cues:e})},_addListeners:function(){var a=this.player,b=a.metadata;a.listen(MetaPlayer.DESTROY,this.destroy,this);b.listen(MetaPlayer.MetaData.FOCUS,
this._onFocus,this);b.listen(MetaPlayer.MetaData.DATA,this._onData,this)},_onFocus:function(){this._removeEvents();var a=this.createEvent();a.initEvent(c.CLEAR,!1,!0);this.dispatchEvent(a)},_onData:function(a){var b=this;d.map(this._cues[a.uri]||[],function(a,c){b._renderCueType(c)});var e=this.createEvent();e.initEvent(c.RENDER,!1,!0);e.uri=a.uri;this.dispatchEvent(e)},_removeEvents:function(a){var b=this.player.popcorn;if(b){var c=b.getTrackEvents();d.each(c,function(c,e){(!a||a==e._natives.type)&&
b.removeTrackEvent(e._id)})}},_renderCues:function(a,b){var c=this;this._scheduleCues(a,b);d.each(this._rules,function(g,h){h.clone==a&&c._scheduleCues(g,b)})},_scheduleCues:function(a,b){var c=this._rules[a]||{},g;this._removeEvents(a);if(c.enabled){var h=d.extend(!0,[],b);c.sequence&&d.each(h,function(a,b){if(g)g.end=b.start;g=b});c.duration&&d.each(h,function(a,b){b.end=b.start+c.duration});c.overrides&&d.each(h,function(a,b){d.extend(!0,b,c.overrides)});var f=this.player.popcorn;f&&f[a]instanceof
Function&&d.each(h,function(b,c){f[a].call(f,d.extend({},c))})}}};c.cueSortFn=function(a,b){return parseFloat(a.start)-parseFloat(b.start)}})();
(function(){var d=jQuery;if(!window.MetaPlayer)window.MetaPlayer={};var f={cssPrefix:"mp",adoptVideo:!0,sizeVideo:!0,sizeMsec:250};MetaPlayer.Layout=function(c,a){this.config=d.extend({},f,a);this.target=d(c).get(0);this.panels=[];MetaPlayer.dispatcher(this);this.target=d(c)[0];this._setup();var b=this;d(document.documentElement).bind("fullscreenchange webkitfullscreenchange",function(a){b.onFullScreen(a)});d(document).bind("mozfullscreenchange",function(a){b.onFullScreen(a)});d(window).bind("resize",
function(){b.isMaximized&&b.maximize()});d(window).bind("mousewheel DOMMouseScroll touchmove",function(a){b.isMaximized&&(a.stopPropagation(),a.preventDefault())});this.isFullScreen=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen};MetaPlayer.layout=function(c,a){return new MetaPlayer.Layout(c,a)};MetaPlayer.Layout.PANEL_OPTIONS={top:0,right:0,bottom:0,left:0,enabled:!0,video:!0};MetaPlayer.Layout.prototype={addPanel:function(c){this.panels.push(d.extend({},MetaPlayer.Layout.PANEL_OPTIONS,
c));this._renderPanels(0);return this.panels.length-1},getPanel:function(c){return this.panels[c]||null},togglePanel:function(c,a,b){if(c=this.getPanel(c))c.enabled=a,this._renderPanels(b)},updatePanel:function(c,a,b){d.extend(this.getPanel(c),a);this._renderPanels(b)},render:function(c){this._renderPanels(c);this.dispatch("resize")},_renderPanels:function(c){var a={top:0,left:0,bottom:0,right:0};d.each(this.panels,function(b,c){c.enabled&&c.video&&(a.top+=c.top||0,a.left+=c.left||0,a.bottom+=c.bottom||
0,a.right+=c.right||0)});this._sizeVideo(a,c)},maximize:function(){this._maximize();this._secondSize()},_maximize:function(){var c=d(this.base),a=d(window);if(!this._restore)this._restore={width:c.width(),height:c.height(),offset:c.offset(),position:c.css("position")};d("body").css("margin",0).css("padding",0);if(!this.restoreZ)this.restoreZ=c.css("z-index");c.css("position","fixed").width("100%").addClass("mp-fullscreen").height("100%").css({"z-index":2147483647}).offset({top:a.scrollTop(),left:a.scrollLeft()});
d("html,body").css("overflow","hidden");this._renderPanels();if(!this.isMaximized)this.isMaximized=!0,this.dispatch("maximize");this.dispatch("resize")},fullscreen:function(){var c=document.documentElement;c.requestFullscreen?c.requestFullscreen():c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullScreen?c.webkitRequestFullScreen():(this.maximize(),this._secondSize())},window:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():
document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},onFullScreen:function(){(this.isFullScreen=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen)?(this.dispatch("fullscreen"),delete this._restore,this.maximize()):this.restore();this._secondSize()},restore:function(){this.window();if(this._restore){var c=d(this.base),a=this._restore;d(window);d("body").css("margin","").css("padding","");c.css("position",a.position).offset({top:a.offset.top,left:a.offset.left}).width(a.width).css({"z-index":this.restoreZ||
"inherit"}).removeClass("mp-fullscreen").height(a.height);d("html,body").css("overflow","auto");this._renderPanels();if(this.isMaximized)this.isMaximized=!1,this.dispatch("restore"),this.dispatch("resize")}},_secondSize:function(){var c=this;setTimeout(function(){c.isMaximized?c._maximize():c.restore()},500)},_sizeVideo:function(c,a){if(this.config.sizeVideo&&this.video){var b=null!=a?a:this.config.sizeMsec,e=d(this.base);d(this.video);var g=e.width()-c.left-c.right,h=e.height()-c.top-c.bottom;this.video.mpf_resize instanceof
Function&&this.video.mpf_resize(g,h);e={"margin-top":c.top,"margin-left":c.left,width:100*(g/e.width())+"%",height:100*(h/e.height())+"%"};a?this.stage.stop().animate(e,b):this.stage.css(e)}},_setup:function(){var c=this.target,a=d(c),b;if(c.play instanceof Function)this.video=c,b=d(this.video._proxyFor||this.video);this.base=a.is(".metaplayer")?a:a.parents(".metaplayer").first();if(!this.base.length)this.base=d("<div/>").addClass("metaplayer").insertAfter(b);this.stage=this.base.children(".mp-stage").first();
if(!this.stage.length)this.stage=d("<div />").addClass("mp-stage").css({position:"relative"}).appendTo(this.base);b&&(this.base.css({height:b.height(),width:b.width()}),this.addVideo());this._renderPanels()},addVideo:function(c){if(c)this.video=c;c=d(this.video._proxyFor||this.video);c.css({height:"100%",width:"100%"});this.config.adoptVideo&&this.stage.append(c);this._renderPanels()},_addStage:function(){return d("<div></div>").addClass("mp-stage").appendTo(this.base).get(0)}}})();
(function(){var d=jQuery,f={},c=function(a){if(!(this instanceof c))return new c(a);this.config=d.extend({},f,a);MetaPlayer.dispatcher(this);this._data={};this._callbacks={};this._lastUri=null};MetaPlayer.MetaData=c;c.FOCUS="focus";c.LOAD="load";c.DATA="data";c.prototype={load:function(a,b,e){b?this._queue(a,b,e):this.setFocusUri(a);if(a){if(this._data[a]){if(this._data[a]._cached){var g=this;setTimeout(function(){g._response(a)},0);return!0}if(this._data[a]._loading)return!0}this._data[a]||(this._data[a]=
{});this._data[a]._loading=(new Date).getTime();b=this.createEvent();b.initEvent(c.LOAD,!1,!0);b.uri=a;b.data=this.getData(a);b=!this.dispatchEvent(b);if(!b)this._data[a]._loading=!1;return b}},getFocusUri:function(){return this._lastUri},setFocusUri:function(a){this._lastUri=a;this._firedDataEvent=!1;var b=this.createEvent();b.initEvent(c.FOCUS,!1,!0);b.uri=a;this.dispatchEvent(b)},getData:function(a){return this._data[a||this._lastUri]},setData:function(a,b,c){b=b||this._lastUri;if(!this._data[b]||
c)this._data[b]=d.extend(!0,{},this._data[b],a),this._data[b]._cached=null==c||c?!0:!1;c&&this._response(b)},destroy:function(){this.dispatcher.destroy();delete this._callbacks;delete this._data;delete this.config},_queue:function(a,b,c){this._callbacks[a]||(this._callbacks[a]=[]);this._callbacks[a].push({fn:b,scope:c})},_response:function(a){var b=this._data[a];if(this._lastUri==a&&!this._firedDataEvent){var e=this.createEvent();e.initEvent(c.DATA,!1,!0);e.uri=a;e.data=b;this.dispatchEvent(e);this._firedDataEvent=
!0}this._callbacks[a]&&(d.each(this._callbacks[a]||[],function(a,c){c.fn.call(c.scope,b)}),delete this._callbacks[a])}}})();
(function(){var d=jQuery,f={autoAdvance:!0,loop:!1,selectSource:!0,appendSources:!1},c=function(a,b){var e=a.video;this.config=d.extend({},f,b);this.player=a;if(!e.getPlaylist&&!e.getItem)this._playlist=[],this._index=0,this.loop=this.config.loop,this.autoAdvance=this.config.autoAdvance,this.selectSource=this.config.selectSource,MetaPlayer.dispatcher(this),c.proxy(this,this.player.video),this._addProxyListeners();this._addListeners();return e};MetaPlayer.Playlist=c;c.TRACK_CHANGE="trackchange";c.PLAYLIST_CHANGE=
"playlistchange";c.proxy=function(a,b){MetaPlayer.proxy.mapProperty("loop autoAdvance selectSource",b,a);MetaPlayer.proxy.proxyFunction("getIndex setIndex getItem updateItem getPlaylist setPlaylist next previous",a,b);MetaPlayer.proxy.proxyEvent(c.TRACK_CHANGE,a,b);MetaPlayer.proxy.proxyEvent(c.PLAYLIST_CHANGE,a,b)};c.prototype={_addProxyListeners:function(){var a=this;this.player.video.addEventListener("ended",function(b){a._onEnded(b)});this.player.video.addEventListener("error",function(b){a._onEnded(b)})},
_addListeners:function(){var a=this;this.player.addEventListener("destroy",function(){a._destroy()});this.player.video.addEventListener("loadstart",function(){a.player.video.preload="auto"});this.player.video.addEventListener("playing",function(){});this.player.video.addEventListener("pause",function(){});this.player.video.addEventListener(c.TRACK_CHANGE,function(b){a._onTrackChange(b)});this.player.metadata.addEventListener("data",function(b){a._onData(b)})},_onEnded:function(){if(this.autoAdvance){var a=
this;setTimeout(function(){a.next()},0)}},_onData:function(a){this.config.appendSources&&this._appendSources(a.data);this.player.video.updateItem(a.uri,a.data)},updateItem:function(a,b,c){if(!(null==this._index||a!=this.getItem()))if(b.resolveUrl&&!c)this._applyResolver(a,b.resolveUrl);else{a=this.player.video;if(c=this._selectResource(b.content))a.pause(),this._applySource(c);if(b.thumbnail&&("none"==a.preload||!a.autoplay))this.player.video.poster=b.thumbnail}},_applyResolver:function(a,b){var c=
this;MetaPlayer.mrss(b,function(b){0<b.length&&c.updateItem(a,b[0],!0)})},_applySource:function(a){if(this.selectSource){var b=this.player.video;b.src=a;b.autoplay?b.play():"none"!=b.preload&&b.load()}},_appendSources:function(a){var b=this.player.video;d(b).empty();d.each(a.content,function(a,c){d("<source>").attr("src",c.url).attr("type",c.type).appendTo(b)})},_selectResource:function(a){var b=this,c=this.player.video,g=[],h=[];if(a)return d.each(a,function(a,d){var f=c.canPlayType(d.type||b._resolveType(d.url));
f&&("probably"==f?g.push(d.url):h.push(d.url))}),g.shift()||h.shift()},_destroy:function(){this.dispatcher.destroy();delete this.player},getPlaylist:function(){return this._playlist},setPlaylist:function(a,b){a instanceof Array||(a=[a]);if(!b)this._playlist=[];var e,g=this._playlist;for(e=0;e<a.length;e++)g.push(a[e]);this.dispatch(c.PLAYLIST_CHANGE);b||this.setIndex(0,!0)},getIndex:function(a){var b=this._playlist;if(null==a)return this._index;0>a&&this.loop&&(a=b.length+a);return!this.loop&&(a>=
b.length||0>a)?null:a%b.length},setIndex:function(a,b){a=this.getIndex(a);if(!b&&(null==a||a==this._index))return!1;this._index=a;this.dispatch(c.TRACK_CHANGE);return!0},_onTrackChange:function(){var a=this.player.playlist.getItem();this.player.metadata.load(a)||this._applySource(a)},getItem:function(a){if(null==a)a=this._index;return this._playlist[this.getIndex(a)]},next:function(){return this.setIndex(this.getIndex()+1)},previous:function(){return this.setIndex(this.getIndex()-1)},_resolveType:function(a){var b=
a.substr(a.lastIndexOf(".")+1);return a.match("www.youtube.com")?"video/youtube":"ogv"==b?"video/ogg":"m3u8"==b?"application/application.vnd.apple.mpegurl":"video/"+b.toLowerCase()}}})();
(function(){var d=jQuery,f={forceRelative:!1,useCache:!0},c=function(a,b){this.config=d.extend({},f,b);this.player=a;this.forceRelative=this.config.forceRelative;MetaPlayer.dispatcher(this);this.player.listen(MetaPlayer.DESTROY,this.destroy,this)};c.QUERY="query";c.RESULTS="results";MetaPlayer.Search=c;MetaPlayer.addPlugin("search",function(){return new c(this)});c.context=function(a,b,c,g){var d=[],f;null==c&&(c=10);null==g&&(g=256);var j,k;0<c?(j=/^\s*(\S+)/,k=a.substr(b,g)):(j=/(\S+)\s*$/,k=b>=
g?a.substr(b-g,g):a.substr(0,b));for(;d.length<Math.abs(c)&&(f=k.match(j));)0<c?(d.push({text:f[1],offset:b}),b+=f[0].length,k=a.substr(b,g)):(b-=f[0].length,d.unshift({text:f[1],offset:b}),k=b>=g?a.substr(b-g,g):a.substr(0,b));return d};c.search=function(a,b,e){if(!b.length)return[];var b=b.replace(/(\W)/g,"\\$1").replace(/(\\\s)+/g,"\\s+"),b=RegExp("(\\b\\S*"+b+"\\S*\\b)","i"),g,d=0,f,j=a.substr(d),k;null==e&&(e=6);for(var l=[];g=j.match(b);){d+=g.index;j=c.context(a,d+g[1].length,10);k=c.context(a,
d,-10);g=[{match:!0,text:g[1],offset:d}];g.offset=d;for(f=0;g.length<e&&(k.length||j.length);)f++,k.length&&0==f%2?g.unshift(k.pop()):j.length&&g.push(j.shift());d+=1;j=a.substr(d);l.push(g)}return l};c.prototype={query:function(a,b,e){var g=this.player.metadata.getData(),d=this.createEvent();d.initEvent(c.QUERY,!1,!1);d.query=a;this.dispatchEvent(d);if(this.config.useCache)this.searchLocal(a,b,e);else{if(!g.ramp.searchapi)throw"no searchapi available";this._queryAPI(g.ramp.searchapi,a,b,e)}},destroy:function(){this.dispatcher.destroy();
delete this.player},searchLocal:function(a,b,e){var g=this.player.cues.getCaptions(),f="",i=[];a.replace(/(^\s|\s$)/,"").toLowerCase().split(/\s+/);d.each(g,function(a,b){i.push({start:b.start,offset:f.length});f+=b.text+" "});var j=function(a){for(var b=0,c=0;c<i.length&&!(a<i[c].offset);c++)b=i[c].start;return b},g=c.search(f,a),k={usingCues:!0,query:a,results:[]};d.each(g,function(a,b){k.results.push({offset:b.offset,start:j(b.offset),words:d.map(b,function(a){return{offset:a.offset,text:a.text,
match:Boolean(a.match),start:j(a.offset)}})})});this.setResults(k,a,b,e)},_queryAPI:function(a,b,c,g){this.forceRelative&&(a=a.replace(/^(.*\/\/[\w.]+)/,""));var f={q:'"'+b+'"'};b?d.ajax(a,{dataType:"xml",timeout:15E3,context:this,data:f,error:function(b,c){console.error("Load search error: "+c+", url: "+a)},success:function(a){this.setResults(this.parseSearch(a,c,g),b,c,g)}}):this.setResults({query:[],results:[]},b,c,g)},setResults:function(a,b,e,g){e?e.call(g,a,b):(e=this.createEvent(),e.initEvent(c.RESULTS,
!1,!1),e.query=b,e.data=a,this.dispatchEvent(e))},parseSearch:function(a){var a=d(a),b=this,c={query:[],results:[]};a.find("SearchTerms Term").each(function(){c.query.push(b._deSmart(d(this).text()))});a.find("Snippets Snippet").each(function(a,f){var i=d(f),j={start:i.attr("time"),words:[]},i=i.find("T");d.each(i,function(a,c){var e=d(c);j.words.push({match:Boolean(e.find("MQ").length),start:e.attr("s"),text:b._deSmart(e.text())})});c.results.push(j)});return c},_deSmart:function(a){return a.replace(/\xC2\x92/,
"\u2019")}}})();
(function(){var d=jQuery,f=function(c){if(c&&c.dispatcher instanceof f)return c.dispatcher;if(!(this instanceof f))return new f(c);this._listeners={};this.attach(c)};MetaPlayer.dispatcher=f;f.prototype={attach:function(c){if(c)c.addEventListener?MetaPlayer.proxy.proxyFunction("addEventListener removeEventListener dispatchEvent",c,this):MetaPlayer.proxy.proxyFunction("addEventListener removeEventListener dispatchEvent",this,c),MetaPlayer.proxy.proxyFunction("listen forget dispatch createEvent event",this,
c),c.dispatcher=this},destroy:function(){delete this._listeners;delete this.addEventListener;delete this.removeEventListener;delete this.dispatchEvent;this.__destroyed=!0},listen:function(c,a,b){this.addEventListener(c,function(c){a.call(b,c,c.data)})},forget:function(c,a){this.removeEventListener(c,a)},dispatch:function(c,a){var b=this.createEvent();b.initEvent(c,!0,!0);b.data=a;return this.dispatchEvent(b)},event:function(c,a){var b=this.createEvent();b.initEvent(c,!0,!0);d.extend(b,a);return this.dispatchEvent(b)},
addEventListener:function(c,a){this._listeners[c]||(this._listeners[c]=[]);this._listeners[c].push(a)},removeEventListener:function(c,a){var b=this._listeners[c]||[],e;for(e=b.length-1;0<=e;e--)b[e]==a&&b.splice(e,1)},createEvent:function(c){return document.createEvent?document.createEvent(c||"Event"):new f.Event},dispatchEvent:function(c){c.type.match(/^time/)?MetaPlayer.log("time",c.type,c):MetaPlayer.log("event",c.type,c);for(var a=(this._listeners[c.type]||[]).concat(),b=0;b<a.length&&!c.cancelBubble;b++)a[b].call(a[b].scope||
this,c,c.data);return!c.defaultPrevented}};f.Event=function(){this.defaultPrevented=this.cancelBubble=!1};f.dispatch=function(c,a,b){var e;e=document.createEvent?document.createEvent("Event"):new f.Event;e.initEvent(a,!0,!0);b instanceof Object&&d.extend(e,b);return c.dispatchEvent(e)};f.Event.prototype={initEvent:function(c,a,b){this.type=c;this.cancelable=b},stopPropagation:function(){this.cancelBubble=!0},stopImmediatePropagation:function(){this.cancelBubble=!0},preventDefault:function(){if(this.cancelable)this.defaultPrevented=
!0}}})();
(function(){var d=jQuery;MetaPlayer.format={zpad:function(d,c){for(var a=""+d;a.length<c;)a="0"+a;return a},seconds:function(f,c){var a=d.extend({},{minutes:!0,seconds:!0,hours:!1},c),b=MetaPlayer.format.zpad,e=Math.floor(f/3600),g=Math.floor(f%3600/60),h=Math.floor(f%60),i=[];a.seconds||g||e?i.unshift(b(h,2)):0<h&&i.unshift(h);a.minutes||e?i.unshift(b(g,2)):0<g&&i.unshift(g);a.hours?i.unshift(b(e,a.hours)):0<e&&i.unshift(e);return i.join(":")},replace:function(d,c){return d.replace(/\{\{(\w+)\}\}/g,function(a,
b){var e;if(c[b]instanceof Function)e=c[b](c);else if(null!=c[b])e=c[b];else return"{!!!"+b+"!!!}";return MetaPlayer.format.replace(e.toString(),c)})}}})();
(function(){var d=jQuery,f={steps:null,throttleMs:250,max:100,min:0,value:25,draggable:!0},c=function(a,b){if(!(this instanceof c))return new c(a,b);var e=d.extend({},f,b);this._steps=e.steps;this._throttleMs=e.throttleMs;this._max=e.max;this._min=e.min;this._value=e.value;this.ui={};this.createMarkup(a);this._render();this.setDraggable(e.draggable);MetaPlayer.dispatcher(this)};MetaPlayer.ProgressBar=c;c.prototype={createMarkup:function(a){this.ui.track=d("<div></div>").css({position:"relative",top:0,
left:0}).bind("mousedown touchstart",this.bind(this._onDragStart)).appendTo(a);this.ui.fill=d("<div></div>").css({position:"absolute",top:0,left:0,height:"100%"}).appendTo(this.ui.track)},getPercent:function(){return this._value/this._range()},getValue:function(){return this._value},getStep:function(){return Math.ceil(this.getPercent()*this._steps)},setValue:function(a){this._value=a;this._render()},setDraggable:function(a){this._draggable=Boolean(a);this.ui.track.css("cursor",this._draggable?"pointer":
"inherit")},setMin:function(a){this._min=a;this._render()},setMax:function(a){this._max=a;this._render()},_range:function(){return this._max-this._min},_render:function(a){null==a&&(a=this.getPercent());this._dragging&&null==a||(0<this._steps&&(a=this.getStep()/this._steps),this.ui.fill.width(100*a+"%"))},_onDragStart:function(a){if(this._draggable)this._dragging={move:this.bind(this._onDragMove),stop:this.bind(this._onDragStop)},this.dispatch("dragstart"),d(document).bind("mousemove touchmove",this._dragging.move).bind("mouseup touchend",
this._dragging.stop),this._onDragMove(a)},_onDragStop:function(a){if(this._dragging)d(document).unbind("mousemove touchmove",this._dragging.move).unbind("mouseup touchend",this._dragging.stop),this._lastFire=null,this._onDragMove(a),this._dragging=null,this.dispatch("dragstop")},_onDragMove:function(a){var b=this._dragPercent(a,this.ui.track);isNaN(b)?b=this._lastP:(this._value=b*this._range(),this._lastP=b);(0===b||0<b)&&this._render(b);a.preventDefault();a=(new Date).getTime();if(!this._lastFire||
a-this._lastFire>this._throttleMs)this._onThrottle();else if(!this._timeout)this._timeout=setTimeout(this.bind(this._onThrottle),this._throttleMs)},_onThrottle:function(){clearTimeout(this._timeout);this._timeout=null;this._lastFire=(new Date).getTime();this.dispatch("dragmove")},bind:function(a){var b=this;return function(){return a.apply(b,arguments)}},_dragPercent:function(a){var b=a.originalEvent,a=a.pageX;if(b.targetTouches){if(!b.targetTouches.length)return NaN;a=b.targetTouches[0].pageX}b=
this.ui.track;b=(a-b.offset().left)/b.width();0>b?b=0:1<b&&(b=1);return b}}})();
(function(){var d=jQuery,f={proxyProperty:function(c,a,b){d.each(c.split(/\s+/g),function(c,g){f.mapProperty(g,b,a)})},proxyFunction:function(c,a,b){d.each(c.split(/\s+/g),function(c,g){a[g]&&(b[g]=function(){return a[g].apply(a,arguments)})})},proxyEvent:function(c,a,b){b.addEventListener||MetaPlayer.dispatcher(b);d.each(c.split(/\s+/g),function(c,g){a.addEventListener(g,function(a){if(b.dispatch)b.dispatch(a.type,a.data);else{var c=document.createEvent("Event");c.initEvent(a.type,!1,!1);b.dispatchEvent(c)}})})},
mapProperty:function(c,a,b){b||(b=a);d.each(c.split(/\s+/g),function(c,g){var d=void 0==b[g]?"_"+g:g,i;i=b[d]instanceof Function?function(){return b[d].apply(b,arguments)}:function(a){void 0!==a&&(b[d]=a);return b[d]};f.define(a,g,{get:i,set:i})})},define:function(c,a,b){b.configurable=!0;try{return Object.defineProperty(c,a,b)}catch(e){}c.__defineGetter&&b.get&&c.__defineGetter__(a,b.get);b.set&&c.__defineSetter__&&c.__defineSetter__(a,b.set)},getProxyObject:function(c){if(c&&c._proxyFor)return c;
var a=document.createElement("div"),b;try{b=a,Object.defineProperty(b,"parentElement",{get:function(){return c.parentElement},configurable:!0})}catch(e){b={},f.mapProperty("children",b,a),f.proxyFunction("appendChild removeChild prependChild",a,b)}if(c){var g,d;for(g in a)if(!g.match(/filters|child|textContent|nodeName|nodeType/i)){d=void 0;try{d=a[g]}catch(i){}d&&d instanceof Function?f.proxyFunction(g,c,b):f.mapProperty(g,b,c)}}b!==a&&(f.mapProperty("nodeName nodeType children textContent",b,a),
f.proxyFunction("appendChild removeChild prependChild",a,b));b._proxyFor=c;return b},proxyPlayer:function(c,a){var b=MetaPlayer.proxy.getProxyObject(a);f.mapProperty("duration currentTime volume muted seeking paused controls autoplay preload src ended readyState ad",b,c);f.proxyFunction("load play pause canPlayType",c,b);f.proxyFunction("mpf_resize mpf_index",c,b);f.proxyEvent("timeupdate seeking seeked playing play pause loadeddata loadedmetadata canplay loadstart durationchange volumechange adstart adstop ended error",
c,b);return b}};if(!window.Ramp)window.Ramp={};MetaPlayer.proxy=f})();
(function(){var d=jQuery;MetaPlayer.script={url:function(f){var c,a=RegExp(f);d("script").each(function(b,e){var g=d(e).attr("src");if(g&&g.match(a))return c=g,!1});return c},base:function(d){var c;d&&(c=this.url(d)||"");c||(c=this.url("metaplayer(-complete)?(.min)?.js"));if(c)return c.substr(0,c.lastIndexOf("/")+1)},query:function(f){var c={},a=RegExp(f),b=location.search&&location.search.substr(1).split("&");d.each(b,function(b,d){var h=d&&d.split("=")||[],i=h[0];if(i){if(f)if(i.match(a))i=i.replace(a,
"");else return;h=h[1]||"";h=decodeURIComponent(h.replace(/\+/g," "));""==h?h=null:h.match(/^\d+$/)?h=parseInt(h):h.match(/^true|false$/)&&(h="true"===h);c[i]=h}});return c},camelCase:function(d){return d.replace(/[\s_\-]+([A-Za-z0-9])?([A-Za-z0-9]*)/g,function(c,a,b){return a.toUpperCase()+b.toLowerCase()})},objectPath:function(d,c,a,b){null==b&&(b=0);var e=c.indexOf(".");if(-1==e)return void 0!==a&&(d[c]=a),d[c];var g=c.slice(0,e),e=c.slice(e+1);void 0!==c&&!(d[g]instanceof Object)&&(d[g]={});return MetaPlayer.script.objectPath(d[g],
e,a,b+1)},parseSrtTime:function(d){d=d.match(/^(?:(\d+):)?(\d\d):(\d\d)[\.,](\d\d\d)$/);if(!d)return null;d[1]||(d[1]=0);return 3600*parseInt(d[1],10)+60*parseInt(d[2],10)+parseInt(d[3],10)+0.0010*parseInt(d[4],10)}}})();
(function(){var d=jQuery,f={disabled:!1,fixedHeight:!1,minHeight:20,mouseDrag:!1,listenChanges:!0,knobAnimateMs:1E3,inertial:!1},c=function(a,b){this.config=d.extend(!0,{},f,b);this.init(a);this.inertiaY=0},a=function(a){return a.pageX||a.originalEvent.touches[0].pageX},b=function(a){return a.pageY||a.originalEvent.touches[0].pageY};c.prototype={init:function(a){this.parent=d(a);var b=this,c=this.parent[0].childNodes;this.body=d("<div></div>").addClass("mp-scroll-body").css("position","relative").bind("resize DOMSubtreeModified size change",
function(a){b.onResize(a)}).append(c);this.scroller=d("<div></div>").css("width","100%").css("height","100%").css("overflow","hidden").addClass("mp-scroll").append(this.body).appendTo(a);this._touchStop=function(a){b.onTouchStop(a)};this._touchMove=function(a){b.onTouchMove(a)};this._knobStop=function(a){b.onKnobStop(a)};this._knobMove=function(a){b.onKnobMove(a)};this.knob=d("<div></div>").css("position","absolute").css("background","black").css("top",0).css("right","-10px").css("border-radius",
"4px").css("background","#000").css("opacity",0.4).hide().css("cursor","pointer").width(8).addClass("mp-scroll-knob").appendTo(this.parent).bind("mousedown touchstart",function(a){b.onKnobStart(a)});this.parent.css("position","relative").css("overflow","visible").bind("mousewheel DOMMouseScroll",function(a){b.onScroll(a)}).bind((this.config.mouseDrag?"mousedown":"")+" touchstart",function(a){b.onTouchStart(a)});this.scrollTo(0,0)},onScroll:function(a){var b=a.originalEvent.wheelDeltaX||a.originalEvent.delta||
10*a.originalEvent.detail||0,c=a.originalEvent.wheelDeltaY||a.originalEvent.delta||10*a.originalEvent.detail||0;this.config.disabled||this.scrollBy(-b,-c)&&a.preventDefault()},scrollBy:function(a,b,c){var d=this.scroller.scrollLeft(),f=this.scroller.scrollTop();return this.scrollTo(d+a,f+b,c)},scrollTop:function(){return this.scroller.scrollTop()},scrollTo:function(a,b,c){var d=this.scroller.scrollTop(),f=this.body.height()-this.parent.height();b>f&&(b=f);0>b&&(b=0);this.scroller.stop();if(b==d)return!1;
if(c){var k=this;this._scrollY=b;this.scroller.animate({scrollLeft:a,scrollTop:b},c,function(){k._scrollY=null});this.render(c);return!1}if(b)return this.scroller.scrollLeft(a),this.scroller.scrollTop(b),this.render(),!0},throttledRender:function(a){this._delay&&clearTimeout(this._delay);if(null==a)a=this.config.knobAnimateMs;var b=this;this._delay=setTimeout(function(){b._delay=null;b.render(a)},0)},render:function(a){if(this.body&&this.body.is(":visible")&&!this.config.disabled){var b=this.body.height(),
c=this.parent.height(),d=Math.min(c-(b-c)/b*c,c);if(d<this.config.minHeight||this.config.fixedHeight)d=this.config.minHeight;var b=(null!=this._scrollY?this._scrollY:this.scroller.scrollTop())/(b-c),b=(c-d)*b,f=b+d;if(this._cacheHeight!=f)this._cacheHeight=f,this.knob.toggle(d<c),a?this.knob.stop().animate({height:d,top:b},a):this.knob.stop().height(d).css("top",b)}},onResize:function(){this.config.listenChanges&&this.throttledRender()},onTouchStart:function(c){this.touching={lastX:this.scroller.scrollLeft(),
lastY:this.scroller.scrollTop()};this.touching.x=a(c)+this.touching.lastX;this.touching.y=b(c)+this.touching.lastY;d(document).bind("mousemove touchmove",this._touchMove).bind("mouseup touchend",this._touchStop);if(this.config.inertial){var g=this;this.inertiaInterval=setInterval(function(){g.onInertiaUpdate()},30)}},onInertiaUpdate:function(){this.inertiaY*=0.9;this.touching||(1>this.inertiaY&&clearInterval(this.inertiaInterval),this.scrollBy(0,this.inertiaY))},onTouchStop:function(){d(document).unbind("mousemove touchmove",
this._touchMove).unbind("mouseup touchend",this._touchStop);this.touching=null},onTouchMove:function(c){var d=-1*(a(c)-this.touching.x),f=-1*(b(c)-this.touching.y);this.inertiaY+=f-this.touching.lastY;this.touching.lastX=d;this.touching.lastY=f;this.scrollTo(d,f)&&(c.stopPropagation(),c.preventDefault())},onKnobStart:function(c){this.scroller.stop();this.dragging={x:a(c)-this.knob.position().left,y:b(c)-this.knob.position().top};d(document).bind("mousemove touchmove",this._knobMove).bind("mouseup touchend",
this._knobStop);c.stopPropagation();c.preventDefault()},onKnobStop:function(){d(document).unbind("mousemove touchmove",this._knobMove).unbind("mouseup touchend",this._knobStop);this.dragging=null},onKnobMove:function(c){var d=a(c)-this.dragging.x,c=b(c)-this.dragging.y,f=this.body.height(),i=this.parent.height(),j=this.knob.height();this.scrollTo(d,c/(i-j)*(f-i))}};if(!window.MetaPlayer)window.MetaPlayer={};MetaPlayer.scrollbar=function(a,b){return new c(a,b)}})();
(function(){var d=function(f,c){if(!(this instanceof d))return new d(f,c);var a=this;MetaPlayer.dispatcher(this);this.delay=f;this.count=c||-1;this._counted=0;this._onTimeout=function(){a._counted++;a.dispatcher.dispatch("time",{count:a._counted,remain:a.count-a._counted});0<a.count&&a.count<a._counted+1&&(a.reset(),a.dispatcher.dispatch("complete"))}};MetaPlayer.timer=d;d.prototype={reset:function(){this._counted=0;this.stop()},stop:function(){clearInterval(this._interval);this.running=this._interval=
null},toggle:function(){this.running?this.stop():this.start()},start:function(){if(!this._interval)this.running=(new Date).getTime(),this._interval=setInterval(this._onTimeout,this.delay)}}})();
(function(){var d=jQuery;if(!window.Ramp)window.Ramp={};MetaPlayer.ui={ensureOffsetParent:function(f){var f=d(f).first(),c=f[0];if(!(c.offsetParent===c.parentNode&&c.offsetParent.offsetParent)){var a=d("<div></div>");a.css("position","relative");a.css("top",0);a.css("left",0);a.css("width","100%");a.css("height","100%");c.width&&a.width(c.width);c.height&&a.height(c.height);f.css("width","100%");f.css("height","100%");f.parent().append(a);a.append(f)}}}})();
