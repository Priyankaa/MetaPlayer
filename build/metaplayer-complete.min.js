/**

MetaPlayer Framework  v0.2.20120405

A standards-based, multiple player, UI and Event framework for JavaScript.

Copyright (c) 2011 RAMP Holdings, Inc.

Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
*/
(function(){var d=window.jQuery,g=window.Popcorn,f={isTouchDevice:null,debug:"",layout:{},metadata:{},search:{},cues:{}},a=function(b,c){if(!(this instanceof a))return new a(b,c);this.config=d.extend({},f,c);a.dispatcher(this);this._plugins={};this._loadQueue=[];this.target=b;this.isTouchDevice=null!=this.config.isTouchDevice?this.config.isTouchDevice:/iPad|iPhone|iPod/i.test(navigator.userAgent);if(this.config.metadata)this.metadata=new a.MetaData(this,this.config);if(this.config.search)this.search=
new a.Search(this,this.config);if(this.config.cues)this.cues=new a.Cues(this,this.config);"string"==typeof b&&(b=d(b).get(0));if(b)if(b.getTrackEvents instanceof Function)this.video=b.media,this.popcorn=b;else if(b.play instanceof Function)this.video=b;if(b&&this.config.layout)this.layout=a.layout(b,this.config.layout);var h=this;setTimeout(function(){h._load()},0)};a.READY="ready";a.DESTROY="destroy";a.prototype={load:function(){this._load();return this},destroy:function(){this.dispatcher.dispatch(a.DESTROY);
delete this.plugins;delete this._loadQueue;delete this.layout;delete this.popcorn},log:function(b,a){if(!(0>this.config.debug.indexOf(a))){var d=Array.prototype.slice.apply(b);d.unshift(a.toUpperCase());console.log.apply(console,d)}},_load:function(){if(!this._loaded){this._loaded=!0;!this.video&&this.layout&&this.html5();if(this.video&&!this.playlist)this.playlist=new a.Playlist(this,this.config.playlist);if(this.video&&!this.popcorn&&null!=g)this.popcorn=g(this.video);var b=this;d(this._loadQueue).each(function(a,
d){d.fn.apply(b,d.args)});this._loadQueue=[];this.ready=!0;this.dispatcher.dispatch(a.READY)}}};a.addPlugin=function(b,c){var d=a.prototype;if(d[b])throw"keyword unavailable: "+b;d[b]=function(){this.ready?c.apply(this,arguments):this._loadQueue.push({name:b,args:arguments,fn:c});return this}};a.addPlayer=function(b,c){var d=a.prototype;if(d[b])throw"keyword unavailable: "+b;d[b]=function(){c.apply(this,arguments);return this}};window.MetaPlayer=a;window.Ramp=a;window.MPF=a})();
(function(){var d=jQuery,g={},f=function(a,b){this.config=d.extend({},g,b);MetaPlayer.dispatcher(this);this._cues={};this._rules={subtitle:{clone:"captions"}};this.player=a;this._addListeners()};MetaPlayer.Cues=f;f.CUES="cues";f.CLEAR="clear";f.prototype={setCueLists:function(a,b){var c=this;d.each(a,function(a,d){c.setCues(a,d,b)})},getCueLists:function(a){return this._cues[a||this.player.metadata.getFocusUri()]},setCues:function(a,b,c){c=c||this.player.metadata.getFocusUri();this._cues[c]||(this._cues[c]=
{});this._cues[c][a]||(this._cues[c][a]=[]);this._cues[c][a]=this._cues[c][a].concat(b);this._dispatchCues(c,a)},getCaptions:function(a){return this.getCues("captions",a)},getCues:function(a,b){var c=b||this.player.metadata.getFocusUri();if(!a)return this.getCueLists();if(this._rules[a]&&this._rules[a].clone)a=this._rules[a].clone;return!this._cues[c]||!this._cues[c][a]?[]:this._cues[c][a].sort(f.cueSortFn)},enable:function(a,b,c){c=d.extend({},this._rules[a],c);c.overrides=d.extend({},c.overrides,
b);c.enabled=!0;this._rules[a]=c;this._renderCues(a,this.getCues(c.clone||a))},disable:function(a){if(a){if(this._rules[a])this._rules[a].enabled=!1;this._removeEvents(a)}},destroy:function(){this._removeEvents();this.dispatcher.destroy();delete this.player},_dispatchCues:function(a,b){if(a==this.player.metadata.getFocusUri()){var c=this,h=[];b?h.push(b):this._cues[a]&&(h=d.map(this._cues[a],function(b,a){return a}));d.each(h,function(b,d){var h=c.getCues(d),g=c.createEvent();g.initEvent(f.CUES,!1,
!0);g.uri=a;g.plugin=d;g.cues=h;c.dispatchEvent(g)&&c._renderCues(d,h)})}},_addListeners:function(){var a=this.player,b=a.metadata;a.listen(MetaPlayer.DESTROY,this.destroy,this);b.listen(MetaPlayer.MetaData.FOCUS,this._onFocus,this)},_onFocus:function(a){this._removeEvents();var b=this.createEvent();b.initEvent(f.CLEAR,!1,!0);this.dispatchEvent(b);this._dispatchCues(a.uri)},_removeEvents:function(a){var b=this.player.popcorn;if(b){var c=b.getTrackEvents();d.each(c,function(c,d){(!a||a==d._natives.type)&&
b.removeTrackEvent(d._id)})}},_renderCues:function(a,b){var c=this;this._scheduleCues(a,b);d.each(this._rules,function(d,f){f.clone==a&&c._scheduleCues(d,b)})},_scheduleCues:function(a,b){var c=this._rules[a]||{},h;if(c.enabled){var f=d.extend(!0,[],b);c.sequence&&d.each(f,function(b,a){if(h)h.end=a.start;h=a});c.duration&&d.each(f,function(b,a){a.end=a.start+c.duration});c.overrides&&d.each(f,function(b,a){d.extend(!0,a,c.overrides)});var g=this.player.popcorn;g&&g[a]instanceof Function&&d.each(f,
function(b,c){g[a].call(g,d.extend({},c))})}}};f.cueSortFn=function(a,b){return parseFloat(a.start)-parseFloat(b.start)}})();
(function(){var d=jQuery;if(!window.MetaPlayer)window.MetaPlayer={};var g={cssPrefix:"mp",adoptVideo:!0,sizeVideo:!0,sizeMsec:250};MetaPlayer.Layout=function(f,a){this.config=d.extend({},g,a);this.target=d(f).get(0);this.panels=[];if(this.target.play instanceof Function)this.base=this._setupVideo();else if(this.target)this.base=this._setupContainer();if(this.base)this.stage=this._addStage()};MetaPlayer.layout=function(d,a){return new MetaPlayer.Layout(d,a)};MetaPlayer.Layout.PANEL_OPTIONS={top:0,
right:0,bottom:0,left:0,enabled:!0,video:!0};MetaPlayer.Layout.prototype={addPanel:function(f){this.panels.push(d.extend({},MetaPlayer.Layout.PANEL_OPTIONS,f));this._renderPanels(0);return this.panels.length-1},getPanel:function(d){return this.panels[d]||null},togglePanel:function(d,a,b){if(d=this.getPanel(d))d.enabled=a,this._renderPanels(b)},updatePanel:function(f,a,b){d.extend(this.getPanel(f),a);this._renderPanels(b)},_renderPanels:function(f){var a={top:0,left:0,bottom:0,right:0};d.each(this.panels,
function(b,c){c.enabled&&c.video&&(a.top+=c.top||0,a.left+=c.left||0,a.bottom+=c.bottom||0,a.right+=c.right||0)});this._sizeVideo(a,f)},_sizeVideo:function(f,a){if(this.config.sizeVideo&&this.video){var b=null!=a?a:this.config.sizeMsec,c=d(this.base),h=d(this.video),j=c.width()-f.left-f.right,c=c.height()-f.top-f.bottom;this.video.mpf_resize instanceof Function&&this.video.mpf_resize(j,c);h.stop().animate({"margin-top":f.top,"margin-left":f.left,width:j,height:c},b)}},_sizeOverlays:function(f,a){var b=
null!=a?a:this.config.sizeMsec;d(this.base).find(".mp-stage").stop().animate({top:f.top,right:f.right,bottom:f.bottom,left:f.left},b)},_setupContainer:function(){return d(this.target).addClass("metaplayer").get(0)},_setupVideo:function(){this.video=this.target;var f=d(this.video),a=f.parents(".metaplayer");if(!a.length){if(!this.config.adoptVideo)return;a=d("<div></div>").addClass("metaplayer").insertAfter(f).append(f)}a.width(f.width());a.height(f.height());return a.get(0)},_addStage:function(){return d("<div></div>").addClass("mp-stage").appendTo(this.base).get(0)}}})();
(function(){var d=jQuery,g={},f=function(a,b){if(!(this instanceof f))return new f(b);this.config=d.extend({},g,b);MetaPlayer.dispatcher(this);this._data={};this._callbacks={};this._lastUri=null};MetaPlayer.MetaData=f;f.FOCUS="focus";f.LOAD="load";f.DATA="data";f.prototype={load:function(a,b,c){b?this._queue(a,b,c):this.setFocusUri(a);if(this._data[a]){if(this._data[a]._cached)return this._response(a),!0;if(this._data[a]._loading)return!0}this._data[a]||(this._data[a]={});this._data[a]._loading=(new Date).getTime();
b=this.createEvent();b.initEvent(f.LOAD,!1,!0);b.uri=a;b.data=this.getData(a);b=!this.dispatchEvent(b);if(!b)this._data[a]._loading=!1;return b},getFocusUri:function(){return this._lastUri},setFocusUri:function(a){if(this._lastUri!=a)this._lastUri=a,e=this.createEvent(),e.initEvent(f.FOCUS,!1,!0),e.uri=a,this.dispatchEvent(e)},getData:function(a){return this._data[a||this._lastUri]},setData:function(a,b,c){b=b||this._lastUri;this._data[b]=d.extend(!0,{},this._data[b],a);this._data[b]._cached=null==
c||c?!0:!1;this._response(b)},destroy:function(){this.dispatcher.destroy();delete this.player;delete this._callbacks;delete this._data;delete this.config},_queue:function(a,b,c){this._callbacks[a]||(this._callbacks[a]=[]);this._callbacks[a].push({fn:b,scope:c})},_response:function(a){var b=this._data[a];if(this._lastUri==a){var c=this.createEvent();c.initEvent(f.DATA,!1,!0);c.uri=a;c.data=b;this.dispatchEvent(c)}this._callbacks[a]&&(d.each(this._callbacks[a]||[],function(a,c){c.fn.call(c.scope,b)}),
delete this._callbacks[a])}}})();
(function(){var d=jQuery,g={sourceTags:!0,selectSource:!0,linkAdvance:!1,autoAdvance:!0,autoBuffer:!0,related:!0,loop:!1},f=function(a,b){this.config=d.extend({},g,b);this.player=a;this._tracks=[];this._index=0;this.loop=this.config.loop;this.preload=this.config.autoBuffer;this.advance=this.config.autoAdvance;this.linkAdvance=this.config.linkAdvance;MetaPlayer.dispatcher(this);this._addListeners()};MetaPlayer.Playlist=f;f.prototype={index:function(a){a=this._resolveIndex(a);if(null!=a)this._index=
a,this._select(this.track());return this._index},queue:function(a){a instanceof Array||(a=[a]);var b=0==this._tracks.length,c=this;d(a).each(function(b,a){c._addTrack(a,!0)});this.dispatcher.dispatch("playlistchange");b&&this._select(this.track())},_select:function(a){this.dispatcher.dispatch("trackchange");this.player.video.pause();this.player.metadata.load(a)||this._setSrc(a)},empty:function(){if(this.config.selectSource)this.player.video.pause(),this.player.video.src="",this._tracks=[],this.transcodes=
null,this._index=0,this.dispatcher.dispatch("playlistchange"),this.dispatcher.dispatch("trackchange")},next:function(){var a=this._index+1;this.track(a);if(this.linkAdvance){var b=this.player.metadata.getData();if(b.link){window.top.location=b.link;return}}this.index(a)},previous:function(){this.index(this._index-1)},track:function(a){void 0===a&&(a=this.index());return this._tracks[this._resolveIndex(a)]},nextTrack:function(){return this.track(this._index+1)},tracks:function(){return this._tracks},
_addTrack:function(a,b){this._tracks.push(a);b||this.dispatcher.dispatch("playlistchange")},_resolveIndex:function(a){if(null==a)return null;var b=this.tracks();0>a&&(a=b.length+a);this.loop&&(a%=b.length);return a>=b.length||0>a?null:a},_addListeners:function(){var a=this.player,b=this.player.metadata;a.listen(MetaPlayer.DESTROY,this.destroy,this);b.listen(MetaPlayer.MetaData.DATA,this._onMetaData,this);var c=this;d(a.video).bind("ended error",function(){c._onEnded()})},_onMetaData:function(a){if(a.uri==
this.track())this.transcodes=a.data.content,this.config.sourceTags&&this.addSourceTags(),this.config.selectSource&&this.selectSource()},addSourceTags:function(){var a=this,b=this.player.video;d.each(this.transcodes,function(c,d){b.appendChild(a._createSource(d.url,d.type))})},selectSource:function(){this.config.selectSource=!0;var a=this.player.video,b=[],c=[];if(this.transcodes){d.each(this.transcodes,function(d,h){var f=a.canPlayType(h.type);f&&("probably"==f?b.push(h.url):c.push(h.url))});var h=
b.shift()||c.shift();h&&this._setSrc(h)}},_setSrc:function(a){var b=this.player.video;b.src=a;b.autoplay||0<this.index()?b.play():b.preload&&b.load()},_createSource:function(a,b){return d("<source>").attr("type",b||"").attr("src",a)[0]},_onEnded:function(){this.advance&&(this.index()==this.tracks().length-1&&this.dispatcher.dispatch("playlistComplete"),this.next())},destroy:function(){this.dispatcher.destroy();delete this.player}}})();
(function(){var d=jQuery,g={forceRelative:!1},f=function(a,b){this.config=d.extend({},g,b);this.player=a;this.forceRelative=this.config.forceRelative;MetaPlayer.dispatcher(this);this.player.listen(MetaPlayer.DESTROY,this.destroy,this)};f.QUERY="QUERY";f.RESULTS="results";MetaPlayer.Search=f;MetaPlayer.addPlugin("search",function(){return new f(this)});f.prototype={query:function(a,b,c){var d=this.player.metadata.getData();if(!d.ramp.searchapi)throw"no searchapi available";var j=this.createEvent();
j.initEvent(f.QUERY,!1,!1);j.query=a;this.dispatchEvent(j);this._queryAPI(d.ramp.searchapi,a,b,c)},destroy:function(){this.dispatcher.destroy();delete this.player},_queryAPI:function(a,b,c,h){this.forceRelative&&(a=a.replace(/^(.*\/\/[\w.]+)/,""));var f={q:'"'+b+'"'};b?d.ajax(a,{dataType:"xml",timeout:15E3,context:this,data:f,error:function(b,c){console.error("Load search error: "+c+", url: "+a)},success:function(a){this.setResults(this.parseSearch(a,c,h),b,c,h)}}):this.setResults({query:[],results:[]},
b,c,h)},setResults:function(a,b,c,d){c?c.call(d,a,b):(c=this.createEvent(),c.initEvent(f.RESULTS,!1,!1),c.query=b,c.data=a,this.dispatchEvent(c))},parseSearch:function(a){var a=d(a),b=this,c={query:[],results:[]};a.find("SearchTerms Term").each(function(){c.query.push(b._deSmart(d(this).text()))});a.find("Snippets Snippet").each(function(a,f){var g=d(f),i={start:g.attr("time"),words:[]},g=g.find("T");d.each(g,function(a,c){var h=d(c);i.words.push({match:Boolean(h.find("MQ").length),start:h.attr("s"),
text:b._deSmart(h.text())})});c.results.push(i)});return c},_deSmart:function(a){return a.replace(/\xC2\x92/,"\u2019")}}})();
(function(){var d=function(g){if(g&&g.dispatcher instanceof d)return g.dispatcher;if(!(this instanceof d))return new d(g);this._listeners={};this.attach(g)};MetaPlayer.dispatcher=d;d.Event=function(){this.defaultPrevented=this.cancelBubble=!1};d.Event.prototype={initEvent:function(d,f,a){this.type=d;this.cancelable=a},stopPropagation:function(){this.cancelBubble=!0},stopImmediatePropagation:function(){this.cancelBubble=!0},preventDefault:function(){if(this.cancelable)this.defaultPrevented=!0}};d.prototype=
{attach:function(d){if(d)d.addEventListener?MetaPlayer.proxy.proxyFunction("addEventListener removeEventListener dispatchEvent",d,this):MetaPlayer.proxy.proxyFunction("addEventListener removeEventListener dispatchEvent",this,d),MetaPlayer.proxy.proxyFunction("listen forget dispatch createEvent",this,d),d.dispatcher=this},destroy:function(){delete this._listeners;delete this.addEventListener;delete this.removeEventListener;delete this.dispatchEvent;this.__destroyed=!0},listen:function(d,f,a){this.addEventListener(d,
function(b){f.call(a,b,b.data)})},forget:function(d,f){this.removeEventListener(d,f)},dispatch:function(d,f){var a=this.createEvent();a.initEvent(d,!0,!0);a.data=f;return this.dispatchEvent(a)},addEventListener:function(d,f){this._listeners[d]||(this._listeners[d]=[]);this._listeners[d].push(f)},removeEventListener:function(d,f){var a=this._listeners[d]||[],b;for(b=a.length-1;0<=b;b--)a[b]==f&&a.splice(b,1)},createEvent:function(g){return document.createEvent?document.createEvent(g||"Event"):new d.Event},
dispatchEvent:function(d){for(var f=this._listeners[d.type]||[],a=0;a<f.length&&!d.cancelBubble;a++)f[a].call(f[a].scope||this,d,d.data);return!d.defaultPrevented}}})();
(function(){MetaPlayer.format={seconds:function(d){var g=function(b,a){for(var d=""+b;d.length<a;)d="0"+d;return d},f=Math.floor(d/3600),a=Math.floor(d%60),d=[g(Math.floor(d%3600/60),2),g(a,2)];f&&d.unshift(f);return d.join(":")},replace:function(d,g){return d.replace(/\{\{(\w+)\}\}/g,function(d,a){var b;if(g[a]instanceof Function)b=g[a](g);else if(null!=g[a])b=g[a];else return"{!!!"+a+"!!!}";return MetaPlayer.format.replace(b.toString(),g)})}}})();
(function(){var d=jQuery,g={proxyProperty:function(f,a,b){d.each(f.split(/\s+/g),function(c,d){g.mapProperty(d,b,a)})},proxyFunction:function(f,a,b){d.each(f.split(/\s+/g),function(c,d){a[d]&&(b[d]=function(){return a[d].apply(a,arguments)})})},proxyEvent:function(f,a,b){b.addEventListener||Ramp.dispatcher(b);d.each(f.split(/\s+/g),function(c,d){a.addEventListener(d,function(a){if(b.dispatch)b.dispatch(a.type);else{var c=document.createEvent("Event");c.initEvent(a.type,!1,!1);b.dispatchEvent(c)}})})},
mapProperty:function(f,a,b){b||(b=a);d.each(f.split(/\s+/g),function(c,d){var f=void 0==b[d]?"_"+d:d,k;k=b[f]instanceof Function?function(){return b[f].apply(b,arguments)}:function(a){void 0!==a&&(b[f]=a);return b[f]};g.define(a,d,{get:k,set:k})})},define:function(d,a,b){try{return Object.defineProperty(d,a,b)}catch(c){}d.__defineGetter&&b.get&&d.__defineGetter__(a,b.get);b.set&&d.__defineSetter__&&d.__defineSetter__(a,b.set)},getProxyObject:function(d){d||(d=document.createElement("div"));try{return Object.defineProperty(d,
"__proptest",{}),d}catch(a){}var b={_proxyNode:d,parentNode:d.parentNode,tagName:d.tagName,ownerDocument:d.ownerDocument,style:d.style,appendChild:function(){d.appendChild.apply(d,arguments)}};try{return Object.defineProperty(b,"__proptest",{}),b}catch(c){}throw"Object.defineProperty not defined";},proxyPlayer:function(d,a){var b=Ramp.proxy.getProxyObject(a);g.mapProperty("duration currentTime volume muted seeking paused controls autoplay preload src ended readyState ad",b,d);g.proxyFunction("load play pause canPlayType",
d,b);g.proxyFunction("mpf_resize",d,b);g.proxyPlayerEvents(d,b);return b},proxyPlayerEvents:function(d,a){g.proxyEvent("timeupdate seeking seeked playing play pause loadeddata loadedmetadata canplay loadstart durationchange volumechange adstart adstop ended error",d,a)}};if(!window.Ramp)window.Ramp={};MetaPlayer.proxy=g})();
(function(){var d=jQuery;Ramp.script={url:function(g){var f,a=RegExp(g);d("script").each(function(b,c){var h=d(c).attr("src");if(h&&h.match(a))return f=h,!1});return f},base:function(d){var f;d&&(f=this.url(d)||"");f||(f=this.url("metaplayer(-complete)?(.min)?.js"));if(f)return f.substr(0,f.lastIndexOf("/")+1)}}})();
(function(){var d=jQuery,g={fixedHeight:!1,minHeight:20,mouseDrag:!1,listenChanges:!0,knobAnimateMs:1E3,inertial:!1},f=function(b,a){this.config=d.extend(!0,{},g,a);this.init(b);this.inertiaY=0},a=function(b){return b.pageX||b.originalEvent.touches[0].pageX},b=function(b){return b.pageY||b.originalEvent.touches[0].pageY};f.prototype={init:function(b){this.parent=d(b);var a=this,f=this.parent[0].childNodes;this.body=d("<div></div>").addClass("mp-scroll-body").css("position","relative").bind("resize DOMSubtreeModified size change",
function(b){a.onResize(b)}).append(f);this.scroller=d("<div></div>").css("width","100%").css("height","100%").css("overflow","hidden").addClass("mp-scroll").append(this.body).appendTo(b);this._touchStop=function(b){a.onTouchStop(b)};this._touchMove=function(b){a.onTouchMove(b)};this._knobStop=function(b){a.onKnobStop(b)};this._knobMove=function(b){a.onKnobMove(b)};this.knob=d("<div></div>").css("position","absolute").css("background","black").css("top",0).css("right","-10px").css("border-radius",
"4px").css("background","#000").css("opacity",0.4).css("cursor","pointer").width(8).addClass("mp-scroll-knob").appendTo(this.parent).bind("mousedown touchstart",function(b){a.onKnobStart(b)});this.parent.css("position","relative").css("overflow","visible").bind("mousewheel",function(b){a.onScroll(b)}).bind((this.config.mouseDrag?"mousedown":"")+" touchstart",function(b){a.onTouchStart(b)});this.scrollTo(0,0)},onScroll:function(b){this.scrollBy(-(b.originalEvent.wheelDeltaX||b.originalEvent.delta||
0),-(b.originalEvent.wheelDeltaY||b.originalEvent.delta||0));b.preventDefault()},scrollBy:function(b,a,d){var f=this.scroller.scrollLeft(),g=this.scroller.scrollTop();this.scrollTo(f+b,g+a,d)},scrollTop:function(){return this.scroller.scrollTop()},scrollTo:function(b,a,d){var f=this.body.height()-this.parent.height(),g=0<f&&this.scroller.scrollTop()+1>=f;a>f&&(a=f);0>a&&(a=0);this.scroller.stop();if(d&&!g){var l=this;this._scrollY=a;this.scroller.animate({scrollLeft:b,scrollTop:a},d,function(){l._scrollY=
null});this.render(d)}else this.scroller.scrollLeft(b),this.scroller.scrollTop(a),this.render()},render:function(b){if(this.body&&this.body.is(":visible")){var a=this.body.height(),d=this.parent.height(),f=Math.min(d-(a-d)/a*d,d);if(f<this.config.minHeight||this.config.fixedHeight)f=this.config.minHeight;var a=(null!=this._scrollY?this._scrollY:this.scroller.scrollTop())/(a-d),a=(d-f)*a,g=a+f;if(this._cacheHeight!=g)this._cacheHeight=g,this.knob.toggle(f<d),b?this.knob.stop().animate({height:f,top:a},
b):this.knob.stop().height(f).css("top",a)}},onResize:function(){this.config.listenChanges&&this.render(this.config.knobAnimateMs)},onTouchStart:function(c){this.touching={lastX:this.scroller.scrollLeft(),lastY:this.scroller.scrollTop()};this.touching.x=a(c)+this.touching.lastX;this.touching.y=b(c)+this.touching.lastY;d(document).bind("mousemove touchmove",this._touchMove).bind("mouseup touchend",this._touchStop);if(this.config.inertial){var h=this;this.inertiaInterval=setInterval(function(){h.onInertiaUpdate()},
30)}},onInertiaUpdate:function(){this.inertiaY*=0.9;this.touching||(1>this.inertiaY&&clearInterval(this.inertiaInterval),this.scrollBy(0,this.inertiaY))},onTouchStop:function(){d(document).unbind("mousemove touchmove",this._touchMove).unbind("mouseup touchend",this._touchStop);this.touching=null},onTouchMove:function(c){var d=-1*(a(c)-this.touching.x),f=-1*(b(c)-this.touching.y);this.inertiaY+=f-this.touching.lastY;this.touching.lastX=d;this.touching.lastY=f;this.scrollTo(d,f);c.stopPropagation();
c.preventDefault()},onKnobStart:function(c){this.scroller.stop();this.dragging={x:a(c)-this.knob.position().left,y:b(c)-this.knob.position().top};d(document).bind("mousemove touchmove",this._knobMove).bind("mouseup touchend",this._knobStop);c.stopPropagation();c.preventDefault()},onKnobStop:function(){d(document).unbind("mousemove touchmove",this._knobMove).unbind("mouseup touchend",this._knobStop);this.dragging=null},onKnobMove:function(c){var d=a(c)-this.dragging.x,c=b(c)-this.dragging.y,f=this.body.height(),
g=this.parent.height(),i=this.knob.height();this.scrollTo(d,c/(g-i)*(f-g))}};if(!window.MetaPlayer)window.MetaPlayer={};MetaPlayer.scrollbar=function(b,a){return new f(b,a)}})();
(function(){var d=function(g,f){if(!(this instanceof d))return new d(g,f);var a=this;Ramp.dispatcher(this);this.delay=g;this.count=f||-1;this._counted=0;this._onTimeout=function(){a._counted++;a.dispatcher.dispatch("time",{count:a._counted,remain:a.count-a._counted});0<a.count&&a.count<a._counted+1&&(a.reset(),a.dispatcher.dispatch("complete"))}};Ramp.timer=d;d.prototype={reset:function(){this._counted=0;this.stop()},stop:function(){clearInterval(this._interval);this.running=this._interval=null},
toggle:function(){this.running?this.stop():this.start()},start:function(){if(!this._interval)this.running=(new Date).getTime(),this._interval=setInterval(this._onTimeout,this.delay)}}})();
(function(){var d=jQuery;if(!window.Ramp)window.Ramp={};Ramp.ui={ensureOffsetParent:function(g){var g=d(g).first(),f=g[0];if(!(f.offsetParent===f.parentNode&&f.offsetParent.offsetParent)){var a=d("<div></div>");a.css("position","relative");a.css("top",0);a.css("left",0);a.css("width","100%");a.css("height","100%");f.width&&a.width(f.width);f.height&&a.height(f.height);g.css("width","100%");g.css("height","100%");g.parent().append(a);a.append(g)}}}})();
(function(){var d=jQuery,g={autoplay:!1,preload:!0,loop:!1,updateMsec:500,playerVars:{experienceID:null}},f=function(a,b){this.config=d.extend(!0,{},g,b);this.experienceID=this.config.playerVars.experienceID;this._src="";this._currentTime=0;this._duration=NaN;this._paused=!0;this._ended=!1;this._autoplay=!0;this._loop=!1;this._autobuffer=!0;this._seeking=!1;this._volume=1;this._muted=!1;this._readyState=0;this._autobuffer=this.config.autobuffer;this._autoplay=this.config.autoplay;this._preload=this.config.preload;
this._loop=this.config.loop;MetaPlayer.dispatcher(this);this.brightcove=a;this.brightcovePlayer=this.brightcove.api.getExperience(this.experienceID);this.brightcoveVideoPlayer=this.brightcovePlayer.getModule(a.api.modules.APIModules.VIDEO_PLAYER);this.brightcoveContent=this.brightcovePlayer.getModule(a.api.modules.APIModules.CONTENT);this.brightcoveExperience=this.brightcovePlayer.getModule(a.api.modules.APIModules.EXPERIENCE);this.brightcoveExperience=this.brightcovePlayer.getModule(a.api.modules.APIModules.CUE_POINTS);
this.addListeners();this.video=MetaPlayer.proxy.proxyPlayer(this)};MetaPlayer.addPlayer("brightcove",function(a,b){!b&&a instanceof Object&&(b=a,a=null);b||(b={});if(!this.video){var c=new f(a,b);this.video=c.video;this.brightcove=c}});MetaPlayer.brightcove=function(a,b){return(new f(a,b)).video};f.prototype={init:function(){},isReady:function(){return this.brightcove&&this.brightcovePlayer.getModule(this.brightcove.api.modules.APIModules.VIDEO_PLAYER)},addListeners:function(){var a=this.brightcoveVideoPlayer,
b=this;a.addEventListener("mediaBegin",function(a){b.onMediaBegin(a)});a.addEventListener("mediaChange",function(a){b.onMediaChange(a)});a.addEventListener("mediaComplete",function(a){b.onMediaComplete(a)});a.addEventListener("mediaError",function(a){b.onMediaError(a)});a.addEventListener("mediaPlay",function(a){b.onMediaPlay(a)});a.addEventListener("mediaProgress",function(a){b.onMediaProgress(a)});a.addEventListener("mediaSeekNotify",function(a){b.onMediaSeekNotify(a)});a.addEventListener("mediaStop",
function(a){b.onMediaStop(a)})},onMediaBegin:function(){},onMediaChange:function(a){this._paused=this._autoplay?!1:!0;this._duration=0.0010*a.duration;this.dispatch("durationchange");this.dispatch("loadedmetadata");this.dispatch("loadeddata")},onMediaComplete:function(){this._ended=!0;this._duration=NaN;this.dispatch("ended")},onMediaError:function(){},onMediaPlay:function(){this._paused=this._ended=!1;this.dispatch("play");this.dispatch("playing")},onMediaProgress:function(a){this._currentTime=a.position;
this.dispatch("timeupdate")},onMediaSeekNotify:function(a){this._seeking=!1;this.dispatch("seeked");this.dispatch("timeupdate");this._currentTime=a.position},onMediaStop:function(a){if(this._duration!=a.position)this._paused=!0,this._ended=!1,this.dispatch("pause")},startVideo:function(){if(this.isReady()){this._ended=!1;var a=this._src;if(a){if(4>this._readyState)this._readyState=4,this.dispatch("loadstart"),this.dispatch("canplay");this._autoplay?this.brightcoveVideoPlayer.loadVideoByID(a):this._preload&&
this.load()}}},doSeek:function(a){this._seeking=!0;this.dispatch("seeking");this.brightcoveVideoPlayer.seek(a);this._currentTime=a;var b=this;setTimeout(function(){b._currentTime=a;b._seeking=!1;b.dispatch("seeked");b.dispatch("timeupdate")},1500)},load:function(){this._preload=!0;this.isReady()&&this.brightcoveVideoPlayer.cueVideoByID(this._src)},play:function(){this._autoplay=!0;this.isReady()&&this.brightcoveVideoPlayer.play()},pause:function(){this.isReady()&&this.brightcoveVideoPlayer.pause()},
canPlayType:function(){return Boolean(type.match(/\/brightcove$/))},paused:function(){return this._paused},duration:function(){return this._duration},seeking:function(){return this._seeking},ended:function(){return!this.isReady()?!1:this._ended},currentTime:function(a){if(!this.isReady())return 0;if(void 0!=a)this._ended=!1,this.doSeek(a);return this._currentTime},muted:function(a){if(null!=a){this._muted=a;if(!this.isReady())return a;this.dispatch("volumechange");return a}return this._muted},volume:function(a){if(null!=
a){this._volume=a;if(!this.isReady())return a;this.dispatch("volumechange")}return this._volume},src:function(a){if(void 0!==a)this._src=a,this.startVideo();return this._src},readyState:function(){return this._readyState}}})();
(function(){var d=jQuery,g=window.flowplayer,f={autoplay:!1,preload:!0,controls:!0,swfUrl:"flowplayer-3.2.7.swf",wmode:"transparent",cssName:"mp-flowplayer",statusThrottleMSec:500,fpConfig:{clip:{scaling:"fit"},canvas:{backgroundColor:"#0000000",backgroundGradient:"none"}}},a=function(b,c){if(!(this instanceof a))return new a(b,c);this.config=d.extend(!0,{},f,c);this.dispatcher=MetaPlayer.dispatcher(this);this._iOS=/iPad|iPhone|iPod/i.test(navigator.userAgent);this.__seeking=null;this.__readyState=
0;this.__ended=!1;this.__paused=!0;this.__duration=NaN;this.__youtubePlugin=!1;this._pageSetup(b);this.__preload=this.config.preload;this.__autoplay=this.config.autoplay;this.__src="";this._statepoll=Ramp.timer(250);this._statepoll.listen("time",this._onPlayStatePoll,this);this._timeupdater=Ramp.timer(250);this._timeupdater.listen("time",this._onTimeUpdate,this);var h=this;this._flowplayer.onLoad(function(){h._onLoad()});this.video=MetaPlayer.proxy.proxyPlayer(this,this._flowplayer.getParent());this._loadPlugins()};
MetaPlayer.flowplayer=function(b,c){return a(b,c).video};MetaPlayer.addPlayer("flowplayer",function(b,c){b.getCommonClip||(c=b,b=d("<div></div>").addClass("mp-video").appendTo(this.layout.stage));this.flowplayer=a(b,c);this.video=this.flowplayer.video});a.prototype={_pageSetup:function(b){if(b.getCommonClip)this._flowplayer=b,b=this._flowplayer.getCommonClip(),this.preload(Boolean(b.autoBuffering)),this.autoplay(Boolean(b.autoPlay));else{var b=d(b).get(0),a=d.extend(!0,{clip:{autoPlay:!1,autoBuffering:!0}},
this.config.fpConfig);this._flowplayer=g(b,{src:this.config.swfUrl,wmode:this.config.wmode},a)}},_loadPlugins:function(){var b=this._flowplayer.getConfig();if(b.hasOwnProperty("plugins")&&(b=b.plugins,b.youtube&&0<b.youtube.url.length))this.__youtubePlugin=!0},_onLoad:function(){if(!this._onLoadFired){this._onLoadFired=!0;var b=this;this._flowplayer.onVolume(function(){b.dispatchIfClip("volumechange")});this._flowplayer.onMute(function(){b.dispatchIfClip("volumechange")});this._flowplayer.onUnmute(function(){b.dispatchIfClip("volumechange")});
this._flowplayer.onPlaylistReplace(function(){b.dispatchIfClip("playlistChange")});this._flowplayer.onClipAdd(function(){b.dispatchIfClip("playlistChange")});this.controls(this.__controls);if(this.__src)this.src(this.__src);else{var a=this._flowplayer.getPlaylist();d.each(a,function(a,c){b._addClipListeners(c);b.__src=c.url})}b.dispatchIfClip("loadstart");(this.preload()||this.autoplay())&&this.load()}},_addClipListeners:function(b){var a=this;b&&(b.onBeforeBegin(function(b){a.ad=b.ovaAd||b.isInStream;
a.ad&&a.dispatch("adstart");return!0}),b.onBegin(function(){a._flowplayer.setVolume(100);a.__seeking=null;a.__duration=NaN;a._flowplayer.unmute()}),b.onStart(function(b){a._setReady();a._setPlaying(!0);a._iOS&&!a.__controls&&a._setHTML5Controls(!1);a.dispatchIfClip("loadeddata");a.__duration=b.duration;a.dispatchIfClip("durationchange");a.dispatchIfClip("loadedmetadata")}),b.onStop(function(){if(a.ad)a.ad=!1,a.dispatch("adstop")}),b.onFinish(function(){a.__duration=NaN;a.__seeking=null;a.ad?(a.dispatch("adstop"),
a.ad=!1):(a.__ended=!0,a._setPlaying(!1),a._flowplayer.stop(),a.dispatchIfClip("ended"))}),b.onPause(function(){a._setPlaying(!1);a._setReady()}),b.onResume(function(b){a._setPlaying(!0);a.dispatchIfClip("play");if(!this.__duration)a.__duration=b.duration,a.dispatchIfClip("durationchange")}),b.onBeforeSeek(function(){a.dispatchIfClip("seeking");a.dispatchIfClip("timeupdate");if(a.paused())a.dispatchIfClip("seeked"),a.__seeking=null}),b.onSeek(function(){this.__currentTimeCache=0;a.__seeking=null;
a.paused()||a.dispatchIfClip("seeked")}))},_setReady:function(){4!=this.__readyState?(this.__readyState=4,this.dispatchIfClip("canplay")):(this.dispatchIfClip("seeking"),this.dispatchIfClip("seeked"))},_setPlaying:function(b){this.__paused=!b;this._statepoll.start()},_setHTML5Controls:function(b){var a=d(this._flowplayer.getParent()).find("video").get(0);a&&(a.controls=b)},load:function(){this.preload(!0);if(this.src()&&this._flowplayer.isLoaded())this._flowplayer.getClip(0).update({autoPlay:this.autoplay(),
autoBuffer:!0}),window.flashembed.__replaced&&!this.__loaded?(this._flowplayer.play(0),this.autoplay()&&this._flowplayer.play(0),this.__loaded=!0):this.autoplay()?this._flowplayer.play():this._flowplayer.startBuffering()},play:function(){this.autoplay(!0);this.__paused=!1;this.load()},pause:function(){this._flowplayer.pause()},canPlayType:function(b){var a=null;if(window.flashembed.__replaced){if(!this._video)this._video=document.createElement("video");this._iOS&&b.match(/mpegurl|m3u8/i)?a="probably":
this._video.canPlayType&&(a=this._video.canPlayType(b))}else this.__youtubePlugin&&b.match(/youtube$/i)?a="probably":b.match(/mp4|flv|jpg/)&&(a="probably");return a},paused:function(){return this.__paused},duration:function(){return this.__duration},seeking:function(){return null!==this.__seeking},ended:function(){return this.__ended},currentTime:function(b){if(void 0!==b){0>b&&(b=0);if(b>this.duration)b=this.duration;this.__seeking=b;this._flowplayer.seek(b)}if(null!==this.__seeking)return this.__seeking;
if(!this._flowplayer.isLoaded())return 0;var b=(new Date).getTime(),a=this.__currentTimeCache,d=b-a;if(a&&d<this.config.statusThrottleMSec)return this.__currentTime+d/1E3;this.__currentTimeCache=b;return this.__currentTime=this._flowplayer.getStatus().time},muted:function(b){void 0!==b&&(b?this._flowplayer.mute():this._flowplayer.unmute());b=this._flowplayer.getStatus();return Boolean(b.muted)},volume:function(b){void 0!==b&&this._flowplayer.setVolume(100*b);return this._flowplayer.getVolume()/100},
controls:function(b){if(!this._flowplayer.isLoaded()){if(void 0!==b)this.__controls=b;return this.config.controls}var a=this._flowplayer.getControls(),d=this._flowplayer.getPlugin("play");if(void 0!==b)(this.__controls=b)?(a&&a.show(),d&&d.show(),this._setHTML5Controls(!0)):(a&&a.hide(),d&&d.hide(),this._setHTML5Controls(!1));return this.__controls},preload:function(b){if(void 0!==b)this.__preload=b;return this.__preload},autoplay:function(b){if(void 0!==b)this.__autoplay=b;return this.__autoplay},
loop:function(b){if(void 0!==b)this.__loop=b;return this.__loop},src:function(b){if(void 0!==b)this._iOS&&this._setHTML5Controls(!0),this.__src=b,this.__loaded=!1,this.__duration=NaN,b=this._flowplayer,b.isLoaded()&&(b.setClip(this._createClipData(this.__src)),this._addClipListeners(b.getClip(0)));return this.__src},readyState:function(b){if(void 0!==b)this.__readyState=b;return this.__readyState},_onPlayStatePoll:function(){this._flowplayer.isPlaying()!==this.paused()&&(this._statepoll.reset(),this.paused()?
(this.dispatchIfClip("pause"),this._timeupdater.reset()):(this.autoplay(!0),this.dispatchIfClip("playing"),this.dispatchIfClip("play"),this._timeupdater.start()))},_onTimeUpdate:function(){this.dispatchIfClip("timeupdate")},_createClipData:function(b){var a={},d=this._flowplayer.getConfig();if("undefined"===typeof b||0>=b.length)return a;this.__youtubePlugin&&!b.match(/http|rtmp/i)?(a.provider="youtube",a.urlResolvers="youtube",a.url="api:"+b):a.url=b;a.autoPlay=!1;a.autoBuffering=!1;a.scaling=d.clip.scaling;
return a},dispatchIfClip:function(a){var c=this._flowplayer.getClip();(!c||!c.ovaAd&&!c.isInStream)&&this.dispatch(a)}}})();
(function(){var d=jQuery,g={applySources:!0,selectSource:!0,preload:!0,muted:!1,autoplay:!1,autoAdvance:!0,related:!0,loop:!1,volume:1,controls:!0},f=function(a,b){if(!(this instanceof f))return new f(a,b);this._iOS=/iPad|iPhone|iPod/i.test(navigator.userAgent);this.config=d.extend({},g,b);this._createMarkup(a)};MetaPlayer.addPlayer("html5",function(a){this.video=(new f(this.layout.stage,a)).video});MetaPlayer.html5=function(a,b){return(new f(a,b)).video};f.prototype={_createMarkup:function(a){var b=
d(a),c=b.find("video");if(b.is("video")||null!=a.currentTime)c=b;0<c.length?this._iOS?(this.video=c.clone(!0,!0).appendTo(c.parent()).get(0),c.remove()):this.video=c.get(0):(a=document.createElement("video"),a.autoplay=this.config.autoplay,a.preload=this.config.preload,a.controls=this.config.controls,a.muted=this.config.muted,a.volume=this.config.volume,a.style.height="100%",a.style.width="100%",this.video=a,b.append(a))}}})();
(function(){var d=jQuery,g=window.jwplayer,f={autostart:!0,autobuffer:!0,controlbar:"none",image:"",id:"jwplayer",volume:100,width:"100%",height:"100%",icons:!1,events:{onTime:function(){},onMeta:function(){}},plugins:{viral:{onpause:!1,oncomplete:!1,allowmenu:!1}}},a=function(b,c){if(!(this instanceof a))return new a(b,c);this.config=d.extend(!0,{},f,c);this.__autoplay=this.config.autostart;this.__autobuffer=this.config.autobuffer;this.__volume=this.config.volume/100;this.__seeking=null;this.__readyState=
0;this.__ended=!1;this.__paused=!this.config.autostart;this.__duration=NaN;this.__metadata=null;this.__started=!1;this.__currentTime=0;this.__src="";this._jwplayer=this._render(d(b).get(0));var h=d("<div></div>").height(b.config.height).width(b.config.width).insertAfter(b.container).append(b.container);this.dispatcher=MetaPlayer.dispatcher(this);this.video=MetaPlayer.proxy.proxyPlayer(this,h.get(0));var j=this;this._jwplayer.onReady(function(){j._onLoad()})};window.MetaPlayer?MetaPlayer.addPlayer("jwplayer",
function(b,c){b.container?d(this.layout.stage).append(b.container):(c=b,b=this.layout.stage);this.jwplayer=a(b,c);this.video=this.jwplayer.video}):window.MetaPlayer={};MetaPlayer.jwplayer=function(b,c){return a(b,c).video};a.prototype={_render:function(a){if(a.container)return this.__autoplay=a.config.autostart,a;a=d("<div class='mpf-jwplayer'></div>").appendTo(a).get(0);return g(a).setup(this.config)},_onLoad:function(){var a=this;this._jwplayer.onPlay(function(){a.__ended=!1;a.__paused=!1;a.__started=
!0;a.dispatch("play")});this._jwplayer.onPause(function(){a.__paused=!0;a.dispatch("pause")});this._jwplayer.onTime(function(c){a.__currentTime=c.position;a.dispatch("timeupdate")});this._jwplayer.onIdle(function(){});this._jwplayer.onBuffer(function(){a.__readyState=4;a.dispatch("buffering")});this._jwplayer.onSeek(function(c){a.__seeking=c.offset;a.__currentTime=c.offset;a.dispatch("seeked")});this._jwplayer.onComplete(function(){a.__ended=!0;a.__started=!1;a.__paused=!0;a.dispatch("ended")});this._jwplayer.onVolume(function(){a.dispatch("volumechange")});
this._jwplayer.onMute(function(){a.dispatch("volumechange")});this._jwplayer.onMeta(function(c){a.__metadata=c.metadata;if(c.metadata.duration&&0<c.metadata.duration)a.__duration=c.metadata.duration,a.dispatch("loadeddata"),a.dispatch("loadedmetadata"),a.dispatch("durationchange")});this._jwplayer.onPlaylist(function(){a.__started=!1;a.dispatch("playlistChange")});this._jwplayer.onError(function(){a.__started=!1});this.__src=this._getSrc();this.dispatch("loadstart");this.dispatch("canplay");(this._getAutoBuffer()||
this._getAutoPlay())&&this.load()},_doSeek:function(a){this.__seeking=!0;this.dispatch("seeking");this._jwplayer.seek(a);this.__currentTime=a;var c=this;setTimeout(function(){c._updateTime();c.__seeking=null;c.dispatch("seeked");c.dispatch("timeupdate")},1500)},_updateTime:function(){this.__currentTime=this._jwplayer.getPosition()},_getAutoPlay:function(){return this.__autoplay},_getAutoBuffer:function(){return this.__autobuffer},_getSrc:function(){return!this._jwplayer?"":this._jwplayer.getPlaylist()[0].file},
_addToPlaylist:function(a){var c=this;if("undefined"!==typeof a&&0<a.length){if(c._jwplayer&&c._jwplayer.getState())c._jwplayer.load({file:a,autostart:c._jwplayer.config.autostart}),clearInterval(c._playlistCheckInterval),c._playlistCheckInterval=null;else{if(c._playlistCheckInterval)return;c._playlistCheckInterval=setInterval(function(){c._addToPlaylist(a)},1E3)}c.__src=a}},_getVideoContainer:function(a){return a.container?a.container.parentElement:a},load:function(){this.src()&&this._jwplayer.load([{file:this.src()}]);
this._jwplayer&&(this._getAutoPlay()?this._jwplayer.play():(this._jwplayer.play(),this._jwplayer.pause()))},play:function(){this._jwplayer.play()},pause:function(){this._jwplayer.pause()},canPlayType:function(){return!0},paused:function(){return this.__paused},duration:function(){return this.__duration},seeking:function(){return null!==this.__seeking},ended:function(){return this.__ended},currentTime:function(a){if(void 0!==a){0>a&&(a=0);if(a>this.duration)a=this.duration;this._doSeek(a)}return this.__currentTime},
readyState:function(a){if(void 0!==a)this.__readyState=a;return this.__readyState},muted:function(a){void 0!==a&&this._jwplayer.setMute();return this._jwplayer.getMute()},volume:function(a){if(null!=a){this.__volume=a;if(!this._jwplayer)return a;this._jwplayer.setVolume(100*a);this.dispatch("volumechange")}return 1<this.__volume?this.__volume/100:this.__volume},src:function(a){this._addToPlaylist(a);return this.__src},controls:function(a){if("undefined"!==typeof a)(this.__controls=a)?this._jwplayer.getPlugin("controlbar").show():
this._jwplayer.getPlugin("controlbar").hide();return this.__controls},mpf_resize:function(a,c){if(this._height!=c||this._width!=a)this._height=c,this._width=a,this._jwplayer.resize(a+"px",c+"px")}}})();
(function(){var d=jQuery,g=window.ovp,f={strategy:{order:["HTML5","Flash","Silverlight"]},sliderdelay:5E3,sliderspeed:"slow",immediately:!1,controls:{src_img:"/images/play.png"},ovp_container_class:"ovp",controller_keepalive_seconds:5,players:{Flash:{src:"ovp-2.1.6.swf",minver:"10",controls:!1,plugins:[]},Silverlight:{src:"ovp-2.3.1.xap",minver:"4.0",controls:!1,plugins:[]},HTML5:{minver:"0",controls:!1}},status_timer:500,ovpConfig:{sources:[{src:"/videos/trailer.ogv",type:"video/ogg"},{src:"/videos/trailer.mp4",
type:"video/mp4"}],width:"100%",height:"100%",posterimg:"/images/poster.png",autobuffer:!0,autoplay:!1,id:"ovp",scalemode:"fit",controls:!1}},a=function(b,c){if(!(this instanceof a))return new a(b,c);this.config=d.extend(!0,{},f,c);this.__readyState=0;this.__paused=!this.config.immediately;this.__duration=NaN;this.__controls=this.__seeking=this.__ended=!1;this.__volume=1;this.__muted=!1;this.__src="";this.__status=0;this._ovp=this._render(d(b).get(0));this.video=d(b).get(0);this.dispatcher=MetaPlayer.dispatcher(this);
MetaPlayer.proxy.proxyPlayer(this,this.video);this._setControls();this._addEventListeners()};window.MetaPlayer?MetaPlayer.addPlayer("ovp",function(b){var c=d("<div></div>").appendTo(this.layout.stage);this.ovp=a(c,b);this.video=this.ovp.video}):window.MetaPlayer={};MetaPlayer.ovp=function(b,c){return a(b,c).video};a.prototype={_render:function(a){var c=this.config.immediately;if(!c)this.config.immediately=!0;g.init(this.config);this.config.immediately=c;return g.render(a,this.config.ovpConfig)[0]},
_addEventListeners:function(){this._loadtimer=Ramp.timer(this.config.status_timer);this._loadtimer.listen("time",this._onBeforeLoad,this);this._loadtimer.start();this._statustimer=Ramp.timer(this.config.status_timer);this._statustimer.listen("time",this._onStatus,this)},_onBeforeLoad:function(){"object"===typeof this._ovp.player&&(this.dispatch("loadstart"),this._loadtimer.reset(),this._onReady(),this._startDurationCheck())},_onReady:function(){this._statustimer.start();this.__readyState=4;this.dispatch("loadeddata");
this.dispatch("canplay");this.load();this.__status=1;this.video.pause();(this.config.immediately||this.config.ovpConfig.autoplay)&&this.video.play()},_startDurationCheck:function(){var a=this;if(!this._durationCheckInterval)this._durationCheckInterval=setInterval(function(){a._onDurationCheck()},1E3)},_onDurationCheck:function(){var a=this._ovp.getDuration();if(0<a)this.__duration=a,this.dispatch("loadeddata"),this.dispatch("loadedmetadata"),this.dispatch("durationchange"),this.dispatch("timeupdate"),
clearInterval(this._durationCheckInterval),this._durationCheckInterval=null},_onStatus:function(){this._ovp.isPlaying()?(this.__paused=!1,2!==this.__status&&this.dispatch("play"),this.dispatch("timeupdate"),this.__status=2):this._ovp.isEnded()?(this.__paused=!0,5!==this.__status&&this.dispatch("ended"),this.__status=5):(this.__paused=!0,3!==this.__status&&this.dispatch("pause"),this.__status=3)},_setControls:function(){if("RENDERED"===this._ovp.controlsState)this.__controls=this._ovp.controls},_getCurrentTimeFromCache:function(){if(!this._ovp.player)return 0;
var a=(new Date).getTime(),c=this.__currentTimeCache,d=a-c;if(c&&d<this.config.status_timer)return this.__currentTime+d/1E3;this.__currentTimeCache=a;a=this._ovp.getCurrentTime();return this.__currentTime=0>a?0:a},doSeek:function(a){this.__seeking=!0;this.dispatch("seeking");this._ovp.seekTo(a);this.__currentTime=a;this.__status=4;var c=this;setTimeout(function(){c.updateTime();c.__seeking=!1;c.dispatch("seeked");c.dispatch("timeupdate")},1500)},updateTime:function(){this.__currentTime=this._ovp.getCurrentTime()},
load:function(){if(this._ovp.player){var a=this.src();if(a)this.config.ovpConfig.sources=[{src:a}]}},play:function(){this.__paused=!1;this._ovp.playpause()},pause:function(){this.__paused=!0;this._ovp.playpause()},canPlayType:function(){return this._ovp.canPlay()},paused:function(){return this.__paused},duration:function(){return this.__duration},seeking:function(){return this.__seeking},ended:function(){return this.__ended},currentTime:function(a){if("undefined"!==typeof a){0>a&&(a=0);if(a>this.duration)a=
this.duration;this.doSeek(a)}return this._getCurrentTimeFromCache()},readyState:function(a){if(void 0!==a)this.__readyState=a;return this.__readyState},muted:function(a){if(null!=a){this.__muted=a;if(!this._ovp)return a;this._ovp.mutetoggle();this.dispatch("volumechange");return a}return this.__muted},volume:function(a){if(null!=a){this.__volume=a;if(!this._ovp)return a;this._ovp.mutetoggle();this.dispatch("volumechange")}return this.__volume},src:function(a){if(void 0!==a)this.__src=a;return this.__src},
controls:function(a){if("undefined"!==typeof a||!1!=a)this.__controls=a;return this.__controls}}})();
(function(){var d=jQuery,g={autoplay:!1,preload:!0,updateMsec:500,playerVars:{enablejsapi:1,version:3,autohide:0,autoplay:0,controls:1,fs:1,hd:1,rel:1,showinfo:1,iv_load_policy:0,cc_load_policy:0,wmode:"transparent"}},f=function(a,b){this.config=d.extend(!0,{},g,b);this.__seeking=!1;this.__readyState=0;this.__muted=this.__ended=!1;this.__paused=!0;this.__duration=NaN;this.__currentTime=0;this.__volume=1;this.__loop=this.config.loop;this.__src="";if(this.config.chromeless){var c=this.config.playerVars;
c.controls=0;c.rel=0;c.showinfo=0}this.preload=this.config.preload;this.autoplay=this.config.autoplay;this.updateMsec=this.config.updateMsec;MetaPlayer.dispatcher(this);"string"==typeof a||!a.getVideoEmbedCode?(this.container=d(a).get(0),this.target=d("<div></div>").appendTo(this.container).get(0),this.init()):(this.youtube=a,this.container=d("<div></div>").appendTo(a.a.parentNode).append(a.a).get(0),this.addListeners());this.video=MetaPlayer.proxy.proxyPlayer(this,this.container)};MetaPlayer.addPlayer("youtube",
function(a,b){!b&&a instanceof Object&&!a.getVideoEmbedCode&&(b=a,a=null);b||(b={});if(!a){if(null==b.chromeless)b.chromeless=!0;a=d("<div></div>").addClass("mp-video").appendTo(this.layout.stage)}var c=new f(a,b);this.video=c.video;this.youtube=c});MetaPlayer.youtube=function(a,b){return(new f(a,b)).video};f.prototype={init:function(){if(window.YT instanceof Function)this.onApiReady();else{var a=document.createElement("script");a.src="http://www.youtube.com/player_api";var b=document.getElementsByTagName("script")[0];
b.parentNode.insertBefore(a,b);var c=this,d=window.onYouTubePlayerAPIReady;window.onYouTubePlayerAPIReady=function(){c.onApiReady();d&&d.call(window)}}},onApiReady:function(){this.youtube=new YT.Player(this.target,{height:"100%",width:"100%",playerVars:this.config.playerVars});this.addListeners()},addListeners:function(){var a=this.youtube,b=this;a.addEventListener("onReady",function(a){b.onReady(a)});a.addEventListener("onStateChange",function(a){b.onStateChange(a)});a.addEventListener("onError",
function(a){b.onError(a)})},onReady:function(){this.isReady()?this.startVideo():(this.error="unabled to find youtube player",this.dispatch("error"))},isReady:function(){return this.youtube&&this.youtube.playVideo},onStateChange:function(a){switch(a.data){case 0:this.__ended=!0;this.__duration=NaN;this.dispatch("ended");break;case 1:this.__paused=!1;this.dispatch("playing");this.dispatch("play");break;case 2:this.__paused=!0;this.dispatch("pause");break;case 3:this.startDurationCheck();this.startTimeCheck();
break;case 5:this.dispatch("canplay"),this.dispatch("loadeddata")}},onError:function(){this.dispatch("error")},startTimeCheck:function(){var a=this;if(!this._timeCheckInterval)this._timeCheckInterval=setInterval(function(){a.onTimeUpdate()},this.updateMsec),this.updateTime()},stopTimeCheck:function(){clearInterval(this._timeCheckInterval);this._timeCheckInterval=null},onTimeUpdate:function(){this.updateTime();this.dispatch("timeupdate")},updateTime:function(){this.__currentTime=this.youtube.getCurrentTime()},
startDurationCheck:function(){var a=this;if(!this.__duration&&!this._durationCheckInterval)this._durationCheckInterval=setInterval(function(){a.onDurationCheck()},this.updateMsec)},onDurationCheck:function(){var a=this.youtube.getDuration();if(0<a)this.__duration=a,this.dispatch("loadedmetadata"),this.dispatch("durationchange"),clearInterval(this._durationCheckInterval),this._durationCheckInterval=null},startVideo:function(){if(this.isReady()){this.__ended=!1;this.__muted&&this.youtube.mute();this.youtube.setVolume(this.__volume);
var a=this.src();if(a){if(4>this.__readyState)this.dispatch("loadstart"),this.__readyState=4;if(a.match("^http"))var b=a.match(/www.youtube.com\/(watch\?v=|v\/)([\w-]+)/)[2];this.youtube.cueVideoById(b||a);this.autoplay?this.play():this.preload&&this.load()}}},doSeek:function(a){this.__seeking=!0;this.dispatch("seeking");this.youtube.seekTo(a);this.__currentTime=a;var b=this;setTimeout(function(){b.updateTime();b.__seeking=!1;b.dispatch("seeked");b.dispatch("timeupdate")},1500)},load:function(){this.preload=
!0;this.isReady()&&-1==this.youtube.getPlayerState()&&(this.src(),this.youtube.playVideo(),this.youtube.pauseVideo())},play:function(){this.autoplay=!0;this.isReady()&&this.youtube.playVideo()},pause:function(){if(!this.isReady())return!1;this.youtube.pauseVideo()},canPlayType:function(a){return Boolean(a.match(/\/youtube$/))},paused:function(){return this.__paused},duration:function(){return this.__duration},seeking:function(){return this.__seeking},ended:function(){return!this.isReady()?!1:0==this.youtube.getPlayerState()},
currentTime:function(a){if(!this.isReady())return 0;if(void 0!=a)this.__ended=!1,this.doSeek(a);return this.__currentTime},muted:function(a){if(null!=a){this.__muted=a;if(!this.isReady())return a;a?this.youtube.mute():this.youtube.unMute();this.dispatch("volumechange");return a}return this.__muted},volume:function(a){if(null!=a){this.__volume=a;if(!this.isReady())return a;this.youtube.setVolume(100*a);this.dispatch("volumechange")}return this.__volume},src:function(a){if(void 0!==a)this.__src=a,this.startVideo();
return this.__src},readyState:function(){return this.__readyState}}})();
(function(){var d=jQuery,g={},f=function(a,b){if(!(this instanceof f))return new f(a,b);this.config=d.extend({},g,b);this.dispatcher=MetaPlayer.dispatcher(a);this.dispatcher.attach(this);this.dispatcher.listen("trackchange",this._onTrackChange,this)};if(!window.Ramp)window.Ramp={};MetaPlayer.mrss=function(a){return f(null,a)};MetaPlayer.addPlugin("mrss",function(a){this.service=f(this.video,a)});f.prototype={load:function(a){d.ajax(a,{dataType:"xml",timeout:15E3,context:this,data:{},error:function(b,
c){console.error("Load playlist error: "+c+", url: "+a)},success:function(a){this.setData(this.parse(a))}})},setData:function(a){this._data=a;var b=this.dispatcher;b.dispatch("metadata",a.metadata);b.dispatch("transcodes",a.transcodes);b.dispatch("captions",a.captions);b.dispatch("tags",a.tags);b.dispatch("metaq",a.metaq);b.dispatch("related",a.related)},_onTrackChange:function(a,b){b&&(a.preventDefault(),"string"==typeof b?this.load(b):this.setData(b))},parse:function(a){var b=this,c=[],a=d(a).find("item").toArray();
d.each(a,function(a,d){c.push(b.parseItem(d))});a=c.shift();a.related=c;return a},parseItem:function(a){var b={metadata:{},transcodes:[],tags:[],captions:[],metaq:{},related:[]},a=d(a),c=a.find("media:content, content");d.each(c,function(a,c){var c=d(c),f=c.attr("codec"),g=c.attr("type")+(f?'codec="'+f+'"':"");b.transcodes.push({url:c.attr("url"),fileSize:c.attr("fileSize"),type:g,medium:c.attr("medium"),isDefault:c.attr("isDefault"),expression:c.attr("expression"),bitrate:c.attr("bitrate"),framerate:c.attr("framerate"),
samplingrate:c.attr("samplingrate"),channels:c.attr("channels"),duration:c.attr("duration"),height:c.attr("height"),width:c.attr("width"),lang:c.attr("lang"),codec:f})});b.metadata.title=a.find("media:title, title").text();b.metadata.description=a.find("media:description, description").text()||a.find("]").text();b.metadata.thumbnail=a.find("media:thumbnail, thumbnail").attr("url");return b},search:function(){throw"not implemented";}}})();
(function(){var d=jQuery,g={msQuotes:!0,serviceUri:"/device/services/mp2-playlist?e="},f=function(a){this.config=d.extend({},g);this.dispatcher=MetaPlayer.dispatcher(this);this.player=a;this._currentUrl=null;this.player.listen(MetaPlayer.READY,this.onReady,this)};MetaPlayer.addPlugin("ramp",function(a,b){if(!this._ramp)this._ramp=new f(this,a);var c=this._ramp;if(a)this.ready?c.load(a,!0):c._currentUrl=a;if(b)c.config=d.extend(c.config,b);return this});f.prototype={onReady:function(){this.player.metadata.listen(MetaPlayer.MetaData.LOAD,
this.onMetaDataLoad,this);this.player.metadata.listen(MetaPlayer.DESTROY,this.onDestroy,this);this._currentUrl&&this.load(this._currentUrl,!0)},onMetaDataLoad:function(a){var b=a.data;b.ramp&&b.ramp.serviceURL&&(this.load(b.ramp.serviceURL),a.stopPropagation(),a.preventDefault())},onDestroy:function(){this.dispatcher.destroy();delete this.config;delete this.player},load:function(a,b){var c=a;if("string"==typeof a&&a.match(/^ramp\:/))var f=this.parseUrl(a),c=f.rampHost+this.config.serviceUri+f.rampId;
d.ajax(c,{dataType:"xml",timeout:15E3,context:this,data:{},error:function(a,b,c){a=this.createEvent();a.initEvent(b,!1,!0);a.message=c;this.dispatchEvent(a)},success:function(a){a=this.parse(a,c);a.length&&this.setItems(a,b)}})},setItems:function(a,b){var c=this.player.metadata,f=this.player.playlist,g=this.player.cues,k=a[0],i=k.metadata.guid;b&&c.setFocusUri(i);c.setData(k.metadata,i,!0);g.setCueLists(k.cues,i);f&&b&&(d.each(a.slice(1),function(a,b){c.setData(b.metadata,b.metadata.guid,!1)}),f.empty(),
f.queue(d.map(a,function(a){return a.metadata.guid})))},parse:function(a,b){var c=this,f=d(a).find("par").toArray(),g=[];d.each(f,function(a,d){g.push(c.parseMedia(d,b))});return g},parseMedia:function(a,b){var c={metadata:{},cues:{}},f=this,g=d(a).find("video");c.metadata.title=g.attr("title");c.metadata.description=g.find("metadata meta[name=description]").text();c.metadata.thumbnail=g.find("metadata meta[name=thumbnail]").attr("content");c.metadata.guid=g.find("metadata meta[name=rampId]").attr("content");
c.metadata.link=g.find("metadata meta[name=linkURL]").attr("content");c.metadata.ramp={};g.find("metadata meta").each(function(a,b){var f=d(b);c.metadata.ramp[f.attr("name")]=f.attr("content")||f.text()});if(c.metadata.ramp.rampId&&!c.metadata.ramp.serviceURL&&b.match(/mp2[-\/]playlist/))c.metadata.ramp.serviceURL=b.replace(/e=(\d+)/,"e="+c.metadata.ramp.rampId);c.metadata.content=[];c.metadata.content.push({name:"default",url:g.attr("src"),type:f.resolveType(g.attr("src")),isDefault:!0});d(a).find("metadata[xml\\:id^=transcodes]").find("meta").each(function(a,
b){var g=d(b);c.metadata.content.push({name:g.attr("name"),type:g.attr("type")||f.resolveType(g.attr("content")),url:g.attr("content"),isDefault:!1})});c.metadata.ramp.tags=[];d(a).find("seq[xml\\:id^=jumptags]").find("ref").each(function(a,b){var f={};d(b).find("param").each(function(a,b){var c=d(b);f[c.attr("name")]=c.text()});if(f.timestamps)f.timestamps=f.timestamps.split(",");c.metadata.ramp.tags.push(f)});c.cues={};d(a).find("seq[xml\\:id^=metaqs]").find("ref").each(function(a,b){var g={};d(b).find("param").each(function(a,
b){var c=d(b),j=c.attr("name"),c=f.deSmart(c.text());"code"==j?(j=d.parseJSON(c),d.extend(!0,g,j)):g[j]=c});c.cues[g.plugin]||(c.cues[g.plugin]=[]);c.cues[g.plugin].push(g)});g=d(a).find("smilText");c.cues.captions=this.parseCaptions(g);return c},parseCaptions:function(a){var b=this,c=d(a).contents(),f=[],g={text:"",start:0,offset:0},k,i=function(a,c){var i;i=d(a);var m=i.attr("begin");null!=m?i=b.parseSeconds(m):(i=i.attr("next"),i=null!=i?b.parseSeconds(i)+(void 0).start:void 0);k=g;k.end=i;c&&
(k.text+=c);f.push(k);g={text:"",start:i,offset:g.offset+1}};c.each(function(a,d){var f=c[a].data;if(void 0===d.tagName)b.config.msQuotes&&(f=b.deSmart(f)),g.text+=f;else switch(d.tagName){case "smil:clear":case "clear":i(d);break;case "smil:tev":case "tev":i(d);break;case "smil:br":case "br":i(d,"<br />");break;default:throw"unsupported tag";}});g.text&&f.push(g);return f},parseSeconds:function(a){var b=a.substr(-1),c=parseFloat(a);if("s"==b)return c;if("m"==b)return 60*c;if("h"==b)return 3600*c;
b=0;a=a.split(":");for(c=0;c<Math.min(a.length,4);c++)b+=Math.pow(60,c)*parseFloat(a[c]);return b},parseUrl:function(a,b){var c=a.split(":");void 0==b&&(b={});"ramp"!==c[0]?b.url=a:(b.rampHost=c[1],b.rampId=c[2]);return b},toUrl:function(a){return"ramp:"+a.ramp.rampHost+":"+a.ramp.rampId},deSmart:function(a){return a.replace(/\xC2\x92/,"\u2019")},resolveType:function(a){var b=a.substr(a.lastIndexOf(".")+1);return a.match("www.youtube.com")?"video/youtube":"ogv"==b?"video/ogg":"m3u8"==b?"application/application.vnd.apple.mpegurl":
"video/"+b}}})();
(function(){var d=jQuery,g=window.Popcorn,f={cssPrefix:"metaplayer-captions",pluginName:"captions",detectTextTracks:!1},a=function(b,c){var h;if("string"!==typeof b){if(!b.__CAPTIONS_ID)b.__CAPTIONS_ID="CC!"+a._count++;h=b.__CAPTIONS_ID}else h=b;if(a.instances[h])return a.instances[h];if(!(this instanceof a))return new a(b,c);this.config=d.extend({},f,c);b.getTrackEvents?(this.popcorn=b,this.target=b.media):this.target=b;this.config=d.extend(!0,{},f,c);this.init();a.instances[h]=this};MetaPlayer.Captions=
a;a.instances={};a._count=0;MetaPlayer.addPlugin("captions",function(b){var c=this.popcorn;this.captions=a(c,b);if(!(c.captions instanceof Function))throw"popcorn plugin does not exist: captions";this.cues.enable("captions")});a.prototype={init:function(){this.container=this.create();this._captions={};d(this.target.parentNode).append(this.container)},findTrackElements:function(){var a=this.popcorn;if(a.parseSRT instanceof Function){var c=d(this.target).find('track[kind="subtitle"]');d.each(c,function(c,
f){var g=d(f).attr("src");if(".srt"==g.substr(g.lastIndexOf(".")))return a.parseSRT(g),!1})}},append:function(){},focus:function(a){var c=this.create("text","div");c.html(a.text);this._captions[a.start]=c;this.container.append(c)},blur:function(a){var c=this._captions[a.start];delete this._captions[a.start];c.remove()},clear:function(){this._captions={};this.container.empty()},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a,c){c||(c="div");return d("<"+c+">").addClass(this.cssName(a))},
cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}};g&&g.plugin("captions",{_setup:function(){a(this)},start:function(b,c){a(this).focus(c)},end:function(b,c){a(this).blur(c)},_teardown:function(){a(this).clear()}})})();
(function(){var d=jQuery,g=window.Popcorn,f={duplicates:!1,cssPrefix:"mp-carousel",slideDurationMs:750,renderAnnotations:!0},a=function(b,c){if(a.instances[b])return a.instances[b];if(!(this instanceof a))return new a(b,c);this.config=d.extend({},f,c);this.init(b);a.instances[b]=this};if(!window.RAMP)window.RAMP={};MetaPlayer.carousel=function(b,c){return new a(b,c)};MetaPlayer.addPlugin("carousel",function(b,c){this.carousel=a(b,c);this.carousel.player=this;this.cues.enable("carousel",{target:b},
{sequence:!0})});a.instances={};a._count=0;a.prototype={init:function(a){this.target=d(a);this.scroller=d("<div></div>").addClass(this.cssName("scroller")).appendTo(this.target);this.navbar=d("<div></div>").addClass(this.cssName("navbar")).appendTo(this.target);this._uniques={};this.target.addClass(this.cssName());this.render();var c=this;this.find(this.cssName("nav")).click(function(a){c._navClick(a)});this.scroller.bind("touchstart",function(a){c._dragStart(a)});this.scroller.bind("touchmove",function(a){c._dragMove(a)});
this.scroller.bind("touchend",function(a){c._dragStop(a)})},_dragStart:function(a){this.dragging=!0;this.scroller.stop();this._dragStartPos=this.eventX(a);this._dragStartScroll=this.scroller.scrollLeft();a.preventDefault()},_dragMove:function(a){a=this.eventX(a)-this._dragStartPos-this._dragStartScroll;this.scroller.stop();this.scroller.scrollLeft(-a)},_dragStop:function(){this.dragging=!1;this.snap()},_navClick:function(a){a=d(a.currentTarget).data("index");this.scrollTo(a);this._highlight(a)},render:function(){var a=
this.find("content");d.each(a,function(a,b){var f=d(b);f.css("position","absolute");f.css("left",100*a+"%")});this._highlight()},scrollTo:function(a){var a=this.target.width()*a,c=this;this.scroller.stop().animate({scrollLeft:a},this.config.slideDurationMs,"swing",function(){c._highlight()})},currentIndex:function(){return this.scroller.scrollLeft()/this.target.width()},snap:function(){this.scrollTo(Math.round(this.currentIndex()))},_highlight:function(a){var c=this.cssName("selected"),a=null!=a?
a:Math.round(this.currentIndex());this.find("selected").removeClass(c);d(this.find("nav")[a]).addClass(c)},eventX:function(a){return(a.pageX||a.originalEvent.touches[0].pageX)-this.target.offset().left},setup:function(a){var c=this;a.index=this.find("nav").length;var f=a.url||a.html;this.config.renderAnnotations&&this.player&&this.player.controls&&this.player.controls.addAnnotation(a.start,null,a.topic||"","metaq");if(!this.config.duplicates){if(null!=this._uniques[f]){a.index=this._uniques[f];return}this._uniques[f]=
a.index}var g=d("<div></div>").addClass(this.cssName("content")).html(a.html||"").appendTo(this.scroller);d("<div></div>").addClass(this.cssName("nav")).attr("title",a.topic||"").data("index",a.index).click(function(a){c._navClick(a)}).appendTo(this.find("navbar"));a.url&&(d("<div></div>").addClass(this.cssName("loading")).appendTo(g),g.load(a.url,function(a,b){"error"==b&&g.empty().addClass(c.cssName("error"))}));this.render()},focus:function(a){this.scrollTo(a.index)},blur:function(){},clear:function(){this.navbar.empty();
this.scroller.empty();this._uniques={}},find:function(a){return this.target.find("."+this.cssName(a))},cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}};g&&g.plugin("carousel",{_setup:function(b){a(b.target).setup(b)},start:function(b,c){a(c.target).focus(c)},end:function(b,c){a(c.target).blur(c)},_teardown:function(b){a(b.target).clear()}})})();
(function(){var d=jQuery,g={cssPrefix:"mp-controls",leading:!0,trackIntervalMsec:5E3,clockIntervalMsec:500,revealTimeMsec:500,revealDelayMsec:500,hideDelayMsec:1500,annotationSeekOffsetSec:-1,createMarkup:!0,renderTags:!0,renderMetaq:!1,autoHide:!1,annotationAnimate:!0,annotationMsec:1200,annotationEntropy:1,annotationSpacing:0.5,showBelow:!0},f=function(a,b){this.config=d.extend(!0,{},g,b);this.container=d(this.config.container||a.layout.base);this.player=a;this.video=a.video;this.annotations=[];
this.video.controls=!1;this._iOS=/iPad|iPhone|iPod/i.test(navigator.userAgent);this._hasTween=d.easing.easeOutBounce;this.config.createMarkup&&this.createMarkup();this.addDataListeners(a);this.addVideoListeners();this.addUIListeners();this.trackTimer=Ramp.timer(this.config.trackIntervalMsec);this.trackTimer.listen("time",this.render,this);this.clockTimer=Ramp.timer(this.config.clockIntervalMsec);this.clockTimer.listen("time",this.onClockTimer,this);this.revealTimer=Ramp.timer(this.config.revealDelayMsec);
this.revealTimer.listen("time",this.onRevealTimer,this);this.hideTimer=Ramp.timer(this.config.hideDelayMsec);this.hideTimer.listen("time",this.onHideTimer,this);this.panel=this.player.layout.addPanel({});if(this.config.autoHide)this.config.showBelow=!1;this.config.showBelow&&this.showBelow(!0);this._iOS&&(this.toggle(!1,0),this.showBelow(!1))};MetaPlayer.addPlugin("controls",function(a){this.controls=new f(this,a)});f.prototype={addVideoListeners:function(){var a=this;d(this.video).bind("pause play seeked seeking ended",
function(b){a.onPlayStateChange(b)});d(this.video).bind("adstart adstop",function(b){a.toggle("adstart"!=b.type)});d(this.video).bind("durationchange",function(){a.renderAnnotations(!0)})},addUIListeners:function(){var a=this;this.find("play").click(function(b){a.onPlayToggle(b)});this.find("track-knob").bind("mousedown touchstart",function(b){return a.onKnobMouseDown(b)});this.find("track-fill").bind("mousedown touchstart",function(b){return a.onKnobMouseDown(b)});this.find("track-buffer").bind("mousedown touchstart",
function(b){return a.onKnobMouseDown(b)});this.find("track").bind("mousedown touchstart",function(b){return a.onKnobMouseDown(b)});d(document).bind("mouseup touchend",function(b){return a.onKnobMouseUp(b)});d(document).bind("mousemove touchmove",function(b){return a.onKnobMouseMove(b)});var b=d(this.container);b.bind("mouseenter touchstart",function(){a.config.autoHide&&(a.hideTimer.reset(),a.revealTimer.start())});b.bind("mouseleave",function(){a.config.autoHide&&(a.revealTimer.reset(),a.hideTimer.start())})},
addDataListeners:function(){var a=this.player.metadata;this.config.renderTags&&a.listen(MetaPlayer.MetaData.DATA,this.onTags,this);this.player.cues.listen(MetaPlayer.Cues.CLEAR,this._onCuesClear,this);this.player.search.listen(MetaPlayer.Search.RESULTS,this.onSearch,this)},onTags:function(a){var b=this;d.each(a.data.ramp.tags,function(a,f){d.each(f.timestamps,function(a,c){b.addAnnotation(c,null,f.term,"tag")})});this.renderAnnotations()},addAnnotations:function(a,b){null==b&&(b="metaq");var c=this;
d.each(a,function(a,d){c.addAnnotation(d.start,d.end,d.text||d.term,b)});this.renderAnnotations()},_onCuesClear:function(){this.clearAnnotations()},onSearch:function(a,b){var c=this;this.removeAnnotations("query");d.each(b.results,function(a,b){var f=b.start,g=[];d.each(b.words,function(a,b){g.push(b.text)});g=g.join(" ").replace(/[\r\n]/g," ");c.addAnnotation(f,null,g,"query")});this.renderAnnotations()},onClockTimer:function(){this.dragging||this.renderTime()},onPlayToggle:function(){var a=this.video;
a.paused?a.play():a.pause();this.render()},onPlayStateChange:function(){this.config.autoHide||(this.toggle(!0),this.config.showBelow&&this.showBelow(!0));this.video.paused?(this.clockTimer.reset(),this.trackTimer.reset()):(this.clockTimer.start(),this.trackTimer.start());this.render()},onKnobMouseDown:function(a){this.dragging=!0;this.find("track-knob").stop();this.onKnobMouseMove(a);a.preventDefault();return!1},onKnobMouseUp:function(a){if(this.dragging)this.dragging=!1,this.setByMousePosition(a)},
onKnobMouseMove:function(a){if(this.dragging){this.find("track-buffer");var b=this.find("track-knob"),c=this.find("track"),d=b.parent().offset(),d=(a.pageX||a.originalEvent.touches[0].pageX)-d.left,d=Math.min(d,c.width()),d=Math.max(d,0);this.renderTime(d/c.width()*this.video.duration);b.css("left",d+"px");this.setByMousePosition(a,!0)}},setByMousePosition:function(a,b){var c=this.find("track-knob");this.find("track");var d=c.parent(),c=c.position().left/d.width()*this.video.duration;b?this.throttledSeek(c):
this.seek(c)},throttledSeek:function(a){clearTimeout(this.seekDelay);var b=this;this.seekDelay=setTimeout(function(){b.seek(a)},100)},seek:function(a){clearTimeout(this.seekDelay);this.video.currentTime=parseFloat(a);this.render()},renderTime:function(a){if(!a)a=this.video.currentTime;this.find("time-current").text(this.formatTime(a))},render:function(){var a=this.video.duration,b=this.video.currentTime;this.find("play").toggleClass(this.cssName("pause"),!this.video.paused);this.find("time-duration").html(" / "+
this.formatTime(a));this.annotations.modified&&this.renderAnnotations();var c=this.config.trackIntervalMsec;this.renderTime();var d;a?(d=100*(b/a),a=Math.min(100*((b+c/1E3)/a),100)):a=d=0;var b=this.find("track-fill").stop(),f=this.find("track-knob").stop();this.video.paused&&(a=d);this.video.seeking||(b.width(d+"%"),this.dragging||f.css("left",d+"%"),!this.video.paused&&this.config.leading&&!this.video.seeking&&!this.dragging&&(b.animate({width:a+"%"},c,"linear"),f.animate({left:a+"%"},c,"linear")))},
autoHide:function(a){a?this.hideTimer.start():this.hideTimer.stop();return this.config.autoHide=a},onRevealTimer:function(){this.toggle(!0);this.revealTimer.reset()},onHideTimer:function(){this.toggle(!1);this.hideTimer.reset()},toggle:function(a,b){var c=this.find();d(this.container).find(".metaplayer-video");var f=void 0==a?!c.is(":visible"):a;f&&c.toggle(!0);this.config.showBelow&&this.showBelow(a);c.stop().animate({opacity:f?1:0},null==b?this.config.revealTimeMsec:b,function(){c.toggle(f)})},
showBelow:function(a){this.player.layout.updatePanel(this.panel,{bottom:a?this.find().height():0})},addAnnotation:function(a,b,c,d){var f=this.find("track-overlay"),g=this.create("track-marker");g.hide();var i=this;g.click(function(){return i.seek(parseFloat(a)+i.options.annotationSeekOffsetSec)});c&&g.attr("title",this.formatTime(a)+"  "+c);d&&g.addClass(this.cssName(d));b==a&&(b=null);f.append(g);this.annotations.modified=!0;this.annotations.push({rendered:!1,start:parseFloat(a),end:parseFloat(b)||
null,el:g,cssClass:d});this.renderAnnotations();return g},renderAnnotations:function(a){var b=this.video.duration;if(b){var c=d(this.video).height(),g=this.config,j,k=this,i=this.config.annotationSpacing,l=this.annotations.sort(f.annotationSort);d(l).each(function(d,f){var l=100*(f.start/b);100<l&&(l=100);f.el.css("left",l+"%");f.end&&f.el.css("width",100*((f.end-f.start)/b)+"%");if(a||!f.rendered)g.annotationAnimate&&k._hasTween&&f.el.css("top",-c).animate({top:0},g.annotationMsec+Math.random()*
g.annotationEntropy*g.annotationMsec,"easeOutBounce"),f.rendered=!0;f.el.show();j&&null!=i&&j.el.position().left+j.el.width()*i>f.el.position().left?f.el.stop().hide():j=f});this.annotations.modified=!1}},removeAnnotations:function(a){var b,c;for(b=this.annotations.length-1;0<=b;b--)c=this.annotations[b],c.cssClass==a&&(this.annotations.splice(b,1),c.el.remove())},clearAnnotations:function(){this.find("track-overlay").empty();this.annotations=[]},createMarkup:function(){var a=this.create().appendTo(this.container),
b=this.create("box");a.append(b);a=this.create("play");a.append(this.create("icon-play"));b.append(a);b.append(this.create("fullscreen"));a=this.create("time");a.append(this.create("time-current"));a.append(this.create("time-duration"));b.append(a);a=this.create("track");a.append(this.create("track-buffer"));a.append(this.create("track-fill"));a.append(this.create("track-overlay"));a.append(this.create("track-knob"));b.append(a)},formatTime:function(a){if(isNaN(a))return"-:-";var b=function(a,b){for(var c=
""+a;c.length<b;)c="0"+c;return c},c=Math.floor(a/3600),d=Math.floor(a%60),a=[b(Math.floor(a%3600/60),2),b(d,2)];c&&a.unshift(c);return a.join(":")},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a){return d("<div></div>").addClass(this.cssName(a))},cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}};f.annotationSort=function(a,b){var c=parseFloat(a.start),d=parseFloat(b.start);return d>c?-1:c>d?1:0}})();
(function(){var d=jQuery,g={cssPrefix:"metaplayer-embed",label:"Embed:",sizes:[{name:"large",width:960,height:590},{name:"medium",width:620,height:380},{name:"small",width:400,height:245}],embedUrl:"{{embedURL}}&width={{width}}&height={{height}}",embedCode:'<iframe src="{{src}}" height="{{height}}px" width="{{width}}px" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" style="border:0; padding:0; margin:0;"></iframe>'},f=function(a,b,c){this.config=d.extend(!0,{},g,c);this.container=
a;this.addDom();b.metadata.listen(MetaPlayer.MetaData.DATA,this.onMetaData,this)};MetaPlayer.Embed=f;MetaPlayer.addPlugin("embed",function(a,b){this.embed=new f(a,this,b)});f.prototype={onMetaData:function(a){this._metadata=a.data;this._current&&this.open(this._current);this.find().show()},addDom:function(){var a=this.create().hide().appendTo(this.container),b=this;this.create("header").text(this.config.label).appendTo(a);d.each(this.config.sizes,function(c,d){b.create("button").addClass(b.cssName(d.name)).appendTo(a).append(b.create("label").text(d.name)).attr("title",
d.width+"x"+d.height).click(function(){b.onClick(d)})});this.create("clear","br").css("clear","both").css("height","1").appendTo(a);var c=this.create("textbox").hide().appendTo(a);this.create("close").html("&otimes;").appendTo(c).click(function(){b.close()});this.create("text","textarea").attr("readonly","readonly").appendTo(c)},onClick:function(a){this._current&&this._current.name==a.name?this.close():this.open(a)},open:function(a){this.close();this._current=a;this.find(a.name).addClass(this.cssName("selected"));
var b=this._metadata,a=d.extend({},b.ramp,b,a);a.src=encodeURI(f.templateReplace(this.config.embedUrl,a));a=f.templateReplace(this.config.embedCode,a);this.find("textbox").show();this.find("text").val(a).select()},close:function(){this.find("selected").removeClass(this.cssName("selected"));this.find("textbox").hide();delete this._current},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a,b){b||(b="div");return d("<"+b+">").addClass(this.cssName(a))},cssName:function(a){return this.config.cssPrefix+
(a?"-"+a:"")}};f.templateReplace=function(a,b){return a.replace(/\{\{(\w+)\}\}/g,function(a,d){return b[d]})}})();
(function(){var d=jQuery,g={target:"",cssPrefix:"metaplayer-endcap",template:"templates/ui.endcap.tmpl.html",siteSearchUrl:"",countDownSec:20,fbUrl:"http://www.facebook.com/plugins/like.php",fadeMs:250},f=function(a,b){if(!(this instanceof f))return new f(a,b);this.config=d.extend({},g,b);this.player=a;this.baseUrl=MetaPlayer.script.base("(metaplayer|ui).endcap.js");this.container=this.player.layout.stage;this.getTemplate()};MetaPlayer.addPlugin("endcap",function(a){this.endcap=f(this,a)});f.prototype=
{getTemplate:function(){d.ajax(this.baseUrl+this.config.template,{context:this,success:function(a){d(this.container).append(a);this.init()}})},init:function(){var a=this,b=this.player.video,c=this.player.playlist;this.player.metadata.listen(MetaPlayer.MetaData.DATA,this.onTrackChange,this);c.listen("playlistchange",this.onTrackChange,this);d(b).bind("play playing seeked loadstart",function(){a.onPlaying()});d(b).bind("ended",function(){a.onEnded()});this.find("countdown").click(function(b){a.countdown.toggle();
b.stopPropagation()});this.find().click(function(){a.countdown.stop()});this.find("preview").click(function(){c.next()});this.find("repeat").click(function(){b.currentTime=0;b.play()});this.find("search-btn").click(function(){a.doSiteSearch()});this.find("search-input").keypress(function(b){13==b.which&&a.doSiteSearch()});c.advance=!1;this.countdown=Ramp.timer(1E3,this.config.countDownSec);this.countdown.listen("time",this.onCountdownTick,this);this.countdown.listen("complete",this.onCountdownDone,
this);if(MetaPlayer.Embed)this.embed=new MetaPlayer.Embed(this.find("embed"),this.player),this.find("embed").show();if(MetaPlayer.Social)this.social=new MetaPlayer.Social(this.find("social"),this.player);this.toggle(!1,!0)},doSiteSearch:function(){var a=this.find("search-input").val(),b=this.siteSearchUrl||this.config.siteSearchUrl,b=b+encodeURIComponent(a);top.location=b},onEnded:function(){this.countdown.start();this.find("countdown").text(this.config.countDownSec);this.toggle(!0)},onPlaying:function(){this.countdown.reset();
this.toggle(!1)},toggle:function(a,b){var c=this.find().stop();void 0===a&&(a=!c.is(":visible"));b?c.toggle(a):a?c.show().animate({opacity:1},this.config.fadeMs):c.animate({opacity:0},this.config.fadeMs,function(){d(this).hide()})},onTrackChange:function(){var a=this.player.metadata.getData();if(a){this.toggle(!1);this.find("again-thumb").attr("src",a.thumbnail);this.find("again-title").text(a.title);this.find("again").show();if(a.ramp)this.siteSearchUrl=a.ramp.siteSearchURL;this.find("next").hide();
(a=this.player.playlist.nextTrack())&&this.player.metadata.load(a,this.onNextData,this)}},onNextData:function(a){this.find("preview-thumb").attr("src",a.thumbnail);this.find("preview-title").text(a.title);this.find("next").show()},onCountdownTick:function(a){this.find("countdown").text(Math.round(a.data.remain))},onCountdownDone:function(){this.player.playlist.next()},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a,b){b||(b="div");return d("<"+b+">").addClass(this.cssName(a))},
cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}}})();
(function(){var d=jQuery,g=window.Popcorn,f={cssPrefix:"mp-ff",filterMsec:500,revealMsec:1500,duplicates:!1,renderAnnotations:!0,baseUrl:""},a=function(b,c){if((b=d(b).get(0))&&a.instances[b.id])return a.instances[b.id];if(!(this instanceof a))return new a(b,c);this.config=d.extend(!0,{},f,c);this.target=d("<div></div>").addClass(this.cssName("scroller")).width("100%").height("100%").appendTo(b);this.scrollbar=MetaPlayer.scrollbar(b);this.seen={};this.init();MetaPlayer.dispatcher(this);a.instances[b.id]=
this};a.instances={};MetaPlayer.addPlugin("framefeed",function(b,c){this.cues.enable("framefeed",{target:b});this.framefeed=a(b,c);this.framefeed.player=this});MetaPlayer.framefeed=a;a.prototype={init:function(){var a=d(this.target);this.items=[];a.addClass(this.cssName())},filter:function(a){this.hideAll();this.query=a;this.render();this.scrollbar.scrollTo(0)},hideAll:function(){var a=this;d.each(this.items,function(c,d){a.hideItem(d)});this.dispatch("size")},render:function(){var a=this;d.each(this.items,
function(c,d){a.renderItem(d)});this.scrollbar.render()},filtered:function(a){return this.query&&(!a.tags||!a.tags.match(this.query))},setup:function(a){this.config.renderAnnotations&&this.player&&this.player.controls&&this.player.controls.addAnnotation(a.start,null,a.topic||"","metaq")},focus:function(a){this.render();a.active=!0;this.frame(a,!0)},blur:function(a){a.active=!1;this.hideItem(a);this.scrollbar.render()},frame:function(a){"string"==typeof a&&(a={url:a});var c=a.url;!c.match("^http")&&
this.config.baseUrl&&(c=this.config.baseUrl+c);if(!this.seen[c]||this.seen[c].start==a.start||this.config.duplicates){this.seen[c]=a;var f=this;a.item?this.renderItem(a,this.config.revealMsec):(a.loadAnimate=!0,c=d("<iframe frameborder='0'></iframe>").attr("src",c).attr("scrolling","no").attr("marginheight",0).attr("marginwidth",0).bind("load",function(){a.loaded=!0;f.renderItem(a,a.loadAnimate?f.config.revealMsec:null)}).attr("height",a.height),a.item=d("<div></div>").addClass(this.cssName("box")).prependTo(this.target).append(c),
this.hideItem(a),this.items.push(a))}},hideItem:function(a){a.item.height(0).hide().css("opacity",0)},renderItem:function(a,c){a.item.stop();a.loadAnimate=!1;if(!a.active||!a.loaded||this.filtered(a))this.hideItem(a);else if(1!=a.item.css("opacity")){a.item.show();var d=this.scrollbar.scrollTop(),f=this;0<d||!c?(a.item.height(a.height).animate({opacity:1},this.config.filterMsec),d&&c&&this.scrollbar.scrollTo(0,d+a.height)):a.item.animate({height:a.height,opacity:1},c,function(){f.scrollbar.render()});
f.dispatch("size")}},clear:function(){d(this.target).empty()},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a,c){c||(c="div");return d("<"+c+">").addClass(this.cssName(a))},cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}};g&&g.plugin("framefeed",{_setup:function(b){a(b.target).setup(b)},start:function(b,c){a(c.target).focus(c)},end:function(b,c){a(c.target).blur(c)},_teardown:function(b){a(b.target).clear()}})})();
(function(){var d=jQuery,g=window.Popcorn,f={cssPrefix:"mp-hl",filterMsec:500,revealMsec:1500,duplicates:!1,baseUrl:""},a=function(b,c){if((b=d(b).get(0))&&a.instances[b.id])return a.instances[b.id];if(!(this instanceof a))return new a(b,c);this.config=d.extend(!0,{},f,c);this.seen={};this.init(b);a.instances[b.id]=this};a.instances={};MetaPlayer.addPlugin("headlines",function(b,c){this.cues.enable("headlines",{target:b});this.headlines=a(b,c)});MetaPlayer.Headlines=a;a.prototype={init:function(a){this.target=
d("<div></div>").addClass(this.cssName()).appendTo(a);this.title=d("<div></div>").addClass(this.cssName("title")).appendTo(this.target);a=d("<div></div>").addClass(this.cssName("nav")).appendTo(this.target);d("<span></span>").addClass(this.cssName("prev")).text("<").appendTo(a);d("<span></span>").addClass(this.cssName("next")).text(">").appendTo(a);this.scroll=d("<div></div>").addClass(this.cssName("scroll")).appendTo(this.target);this.items=[]},render:function(){},rss:function(a,c){!a.match("^http")&&
this.config.baseUrl&&(a=this.config.baseUrl+a);d.ajax(a,{dataType:"xml",timeout:15E3,context:this,data:{},error:function(c,d){console.error("Load RSS error: "+d+", url: "+a)},success:function(a){this.onRSS(a,c)}})},onRSS:function(a,c){this.clear();this.title.text(c||d(a).find("channel").children("title").text());var f=d(a).find("item"),g=this;d.each(f,function(a,b){var c=d(b);g.addItem(c.find("title").text(),c.find("link").text())})},addItem:function(a,c){d("<a></a>").text(a).addClass(this.cssName("item")).attr("href",
c).appendTo(this.scroll);d(document.createTextNode(" ")).appendTo(this.scroll)},focus:function(a){this.rss(a.url,a.title)},blur:function(){this.clear()},clear:function(){this.scroll.empty();this.title.empty()},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a,c){c||(c="div");return d("<"+c+">").addClass(this.cssName(a))},cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}};g&&g.plugin("headlines",{_setup:function(b){a(b.target)},start:function(b,c){a(c.target).focus(c)},
end:function(b,c){a(c.target).blur(c)},_teardown:function(b){a(b.target).clear()}})})();
(function(){var d=jQuery,g={target:"",autoHide:!0,cssPrefix:"metaplayer-overlay",template:"templates/ui.overlay.tmpl.html",captions:!1,mouseDelayMsec:1E3,seekBeforeSec:1,hideOnEnded:!0},f=function(a,b){if(!(this instanceof f))return new f(a,b);this.config=d.extend({},g,b);this.player=a;this.video=a.video;this.dispatcher=a.dispatcher;this.popcorn=a.popcorn;this.playlist=a.playlist;this.baseUrl=MetaPlayer.script.base("(metaplayer|ui).overlay.js");this.config.container?(this.container=this.config.container,
this.init()):(this.container=this.config.target||this.player.layout.stage,this.createMarkup());this.video.overlay=this};MetaPlayer.addPlugin("overlay",function(a){this.overlay=f(this,a)});f.prototype={init:function(){this.addUIListeners();this.addPlayerListeners();this.addPlaylistListeners();this.addPopcornListeners();this.addServiceListeners();this.onVolumeChange();this.onPlayStateChange();this.setCaptions(this.config.captions);(this.player.isTouchDevice||!this.config.autoHide)&&this.find("close-btn").show();
if(MetaPlayer.Embed)this.embed=new MetaPlayer.Embed(this.find("embed"),this.player),this.find("embed").show();if(MetaPlayer.Social)this.social=new MetaPlayer.Social(this.find("social"),this.player)},getMarkup:function(){d("<div></div>").addClass("metaplayer-overlay");d("<div></div>").addClass("metaplayer-overlay-container")},addUIListeners:function(){var a=this;this.find("play").click(function(){a.video.play()});this.find("pause").click(function(){a.video.pause()});this.find("mute").click(function(){a.video.muted=
!0});this.find("unmute").click(function(){a.video.muted=!1});this.find("search-btn").click(function(){a.doSearch()});this.find("search-input").keypress(function(b){13==b.which&&a.doSearch()});this.find("close-btn").click(function(){a.toggle(!1)});this.find("results-close").click(function(){a.find("search-input").val("");a.player.search.query("")});var b=this.find("volume-bg");d(b).bind("mousedown touchstart",function(b){a.onVolumeDragStart(b)});d(document).bind("mouseup touchend",function(b){a.onVolumeDragEnd(b)});
d(document).bind("mousemove touchmove",function(b){if(a.volumeDragging)a.onVolumeDrag(b)});this.player.isTouchDevice?this._addTouchListeners():this._addMouseListeners();this.find("preview").click(function(){a.playlist.next()})},_addTouchListeners:function(){var a=this,b=d(this.container).find("video");b.bind("touchstart",function(){console.log("touch start "+b);a._ended||a.delayedToggle(!0)})},_addMouseListeners:function(){var a=this,b=d([this.container,this.player.video]);b.bind("mouseenter",function(){a._ended||
a.delayedToggle(!0)});b.bind("mouseleave",function(){a._ended||a.delayedToggle(!1)})},addServiceListeners:function(){this.player.metadata.listen(MetaPlayer.MetaData.DATA,this.onTags,this)},onTags:function(a){if(a.data.ramp){var b=this;d.each(a.data.ramp.tags||[],function(a,d){b.createTag(d.term)})}},renderNextUp:function(){var a=this.player.metadata,b=this.playlist.nextTrack();b&&a.load(b,this.onNextData,this)},onNextData:function(a){this.find("preview-thumb").attr("src",a.thumbnail);this.find("preview-title").text(a.title);
this.find("next").show()},onPlaylistChange:function(){this.renderNextUp()},onTrackChange:function(){this.nextup=null;this.clearSearch();d("."+this.cssName("tag")).remove();this.find("next").hide();this.renderNextUp()},createTag:function(a){var b=this,c=this.create("tag"),d=this.create("tag-label");d.text(a);c.append(d);c.data("term",a);c.click(function(a){b.onTagClick(a)});this.find("tags").prepend(c)},onTagClick:function(a){this.player.search.query(d(a.currentTarget).data().term)},doSearch:function(){this.player.search.query(this.find("search-input").val())},
onSearchStart:function(a){this.find("search-input").val(a.query)},onSearchResult:function(a){this.clearSearch();a=a.data;if(a.query.length){var b=0==a.results.length;this.find("results-none").toggle(b);var c=this;d.each(a.results,function(a,b){c.createResult(b)});this.find("tags").hide();this.find("results").show()}},clearSearch:function(){this.find("result-list").empty();this.find("tags").show();this.find("results").hide()},createResult:function(a){var b=this,c=this.create("result");c.click(function(){b.video.currentTime=
a.start-b.config.seekBeforeSec});var f=this.create("result-time");f.text(Ramp.format.seconds(a.start));c.append(f);var g=this.create("result-text");c.append(g);d.each(a.words,function(a,c){var f=c.text;c.match&&(f=d("<span>"),f.addClass(b.cssName("match")),f.text(c.text));g.append(f);g.append(" ")});this.find("result-list").append(c)},addPopcornListeners:function(){if(this.popcorn){var a=this;this.find("cc").click(function(){a.setCaptions(!1)});this.find("cc-off").click(function(){a.setCaptions(!0)})}},
setCaptions:function(a){var b=this.player.popcorn;a?b.enable("captions"):b.disable("captions");this.find("cc").toggle(a);this.find("cc-off").toggle(!a)},addPlayerListeners:function(){var a=this,b=d(this.player.video);b.bind("canplay",function(){var b=a.video.volume;a.video.volume=0.5;0.5!=a.video.volume&&a.hideVolumeControls();a.video.volume=b});b.bind("pause play seeked seeking canplay",function(){a.onPlayStateChange()});b.bind("ended",function(){a.onEnded()});b.bind("volumechange",function(){a.onVolumeChange()})},
addPlaylistListeners:function(){var a=this.player.playlist;a.listen("trackchange",this.onTrackChange,this);a.listen("playlistchange",this.onPlaylistChange,this);this.player.search.listen(MetaPlayer.Search.QUERY,this.onSearchStart,this);this.player.search.listen(MetaPlayer.Search.RESULTS,this.onSearchResult,this)},onVolumeDragStart:function(a){this.volumeDragging=!0;this.onVolumeDrag(a);a.preventDefault()},onVolumeDragEnd:function(a){if(this.volumeDragging)this.volumeDragging=!1,this.onVolumeDrag(a),
a.preventDefault()},onVolumeDrag:function(a){var b=a.originalEvent,a=a.pageX;if(b.targetTouches){if(!b.targetTouches.length)return;a=b.targetTouches[0].pageX}b=this.find("volume-bg");b=(a-b.offset().left)/b.width();0>b&&(b=0);1<b&&(b=1);this.video.muted=!1;this.video.volume=b},hideVolumeControls:function(){this.find("mute").hide();this.find("unmute").hide();this.find("volume-bg").hide()},onVolumeChange:function(){var a=this.video.muted;this.find("mute").toggle(!a);this.find("unmute").toggle(a);a=
a?0:this.video.volume;this.find("volume").width(100*a+"%")},onPlayStateChange:function(){this._ended=!1;this.video.paused?(this.find("pause").hide(),this.find("play").show()):(this.find("play").hide(),this.find("pause").show())},onEnded:function(){if(this.config.hideOnEnded&&this.config.autoHide)this._ended=!0,this.find().stop().height(0)},createMarkup:function(){d.ajax(this.baseUrl+this.config.template,{context:this,success:function(a){d(this.container).append(a);this.config.autoHide&&this.find().height(0);
this.init()}})},delayedToggle:function(a){this._delayed=a;if(this.config.autoHide||a){var b=this;setTimeout(function(){this.__opened!=b._delayed&&b.toggle(b._delayed)},this.config.mouseDelayMsec)}},toggle:function(a){this.__opened=a;var b=this.find().stop(),c=this.find("container").height();a?b.animate({height:c},500,function(){b.height("")}):b.animate({height:0},500);this.embed&&this.embed.close(0)},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a,b){b||(b="div");
return d("<"+b+">").addClass(this.cssName(a))},cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}}})();
(function(){var d=jQuery,g={cssPrefix:"mp-search",tags:!0,query:"",seekBeforeSec:0.25,context:3,strings:{tagHeader:"In this video:",searchPlaceholder:"Search transcript...",ellipsis:"...",resultsHeader:'Showing {{count}} {{results}} for "{{query}}":',results:function(a){return"result"+(1==a.count?"":"s")},clear:"x"}},f=function(a,b,c){if(!(this instanceof f))return new f(a,b,c);this.player=b;this.target=d(a);this.config=d.extend(!0,{},g,c);this.createMarkup();this.scrollbar=MetaPlayer.scrollbar(this.results);
this.addListeners();this.clear()};f.instances={};f._count=0;MetaPlayer.SearchBox=f;MetaPlayer.addPlugin("searchbox",function(a,b){this.searchbox=f(a,this,b)});f.getPhrase=function(a,b,c){"string"==typeof a&&(a=a.split(" "));var d=2*c+1,f=0;a.length-b<=c?f=a.length-d:b>c&&(f=b-c);0>f&&(f=0);return{words:a.slice(f,f+d),start:f,len:d}};f.prototype={createMarkup:function(){var a=d(this.target),b=this.create(),c=this.create("form");b.append(c);var f=d('<input type="text" />');f.addClass(this.cssName("input"));
f.val(this.config.query);f.attr("placeholder",this.getString("searchPlaceholder"));c.append(f);f=this.create("submit","a");f.append(this.create("submit-label","span"));c.append(f);this.results=this.create("results").appendTo(b);this.create("tags").appendTo(b);this.container=b;a.append(this.container)},addListeners:function(){var a=this;this.find("submit").bind("click",function(){a.onSearch()});this.find("input").bind("keypress",function(b){if(13==b.which)a.onSearch()});this.find("results").bind("click",
function(b){var c=d(b.target).parents("."+a.cssName("result"));c.length||(c=d(b.target));b=c.data().start;if(a.player)a.player.video.currentTime=b-a.config.seekBeforeSec});this.player.metadata.listen(MetaPlayer.MetaData.DATA,this.onTags,this);this.player.search.listen(MetaPlayer.Search.QUERY,this.onSearchStart,this);this.player.search.listen(MetaPlayer.Search.RESULTS,this.onSearchResult,this)},onTags:function(a){a=a.data.ramp;if(a.tags){var b=this.find("tags"),c=this;b.empty();this.create("tag-header").text(this.getString("tagHeader")).appendTo(b);
d.each(a.tags,function(a,f){var g=d("<div></div>").addClass(c.cssName("tag")).appendTo(b);d("<span></span>").addClass(c.cssName("tag-label")).text(f.term).click(function(){c.search(f.term)}).appendTo(g)})}},onSearch:function(){this.search(this.find("input").val())},search:function(a){this.player.search.query(a)},clear:function(){this.scrollbar.body.empty();this.find("close").hide();this.find("tags").show()},onClose:function(){this.search("")},onSearchStart:function(a){this.find("input").val(a.query)},
onSearchResult:function(a,b){this.clear();if(b.query.length){this.find("tags").hide();this.find("close").show();var c=this.scrollbar.body;d("<div></div>").addClass(this.cssName("result-count")).text(this.getString("resultsHeader",{count:b.results.length,query:b.query.join(" ")})).appendTo(c);var g=this;this.create("close").text(this.getString("clear")).bind("click",function(){g.onClose()}).appendTo(c);d.each(b.results,function(a,b){var i=g.create("result"),l=b.start,n=[],o;d.each(b.words,function(a,
b){var c=d("<span>").text(b.text);b.match&&(o=a,c.addClass(g.cssName("match")));n.push(c.get(0))});var m=f.getPhrase(n,o,g.config.context),l=b.words[m.start].start;i.data("start",l);g.create("time").text(Ramp.format.seconds(l)).appendTo(i);d.each(m.words,function(a,b){i.append(b);a+1<m.words.length&&i.append(" ")});l=g.getString("ellipsis");i.appendTo(c).prepend(l).append(l)})}},getString:function(a,b){var c=d.extend({},this.config.strings,b);return MetaPlayer.format.replace(this.config.strings[a],
c)},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a,b){b||(b="div");return d("<"+b+">").addClass(this.cssName(a))},cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}}})();
(function(){var d=jQuery,g={cssPrefix:"metaplayer-social",facebookApi:"//www.facebook.com/plugins/like.php",twitterApi:"//platform.twitter.com/widgets/tweet_button.html",shareText:"Check this video out -- "},f=function(a,b,c){this.config=d.extend(!0,{},g,c);this.player=b;this.container=a;this.addDom();this.player.metadata.listen(MetaPlayer.MetaData.DATA,this.onMetaData,this)};MetaPlayer.Social=f;MetaPlayer.addPlugin("social",function(a,b){new f(a,this,b)});f.prototype={addDom:function(){var a=this.create().hide().appendTo(this.container);
this.create("clear").appendTo(a)},onMetaData:function(a){this.setFacebook(a.data);this.setTwitter(a.data);this.find().show()},setTwitter:function(a){var b={count:"horizontal",lang:"en"};b.text=this.config.shareText+(a.title||"");b.url=a.link||a.linkURL;if(a.hashtags)b.hashtags=a.hashtags;a=d.map(b,function(a,b){return escape(b)+"="+escape(a)}).join("&");b=this.create("twitter","iframe").attr("allowtransparency","true").attr("frameborder","0");b.attr("src",this.config.twitterApi+"#"+a);this.find("twitter").remove();
this.find().prepend(b)},setFacebook:function(a){var b={href:"",layout:"button_count",show_faces:!1,action:"like",colorscheme:"light",width:"",height:""},c=this.create("facebook","iframe").attr("allowtransparency","true").attr("frameborder","0");b.href=a.link||a.linkURL||document.location.toString();b.width=c.width();b.height=c.height();a=this.config.facebookApi+"?"+d.param(b,!0);c.attr("src",a);this.find("facebook").remove();this.find().prepend(c)},find:function(a){return d(this.container).find("."+
this.cssName(a))},create:function(a,b){b||(b="div");return d("<"+b+">").addClass(this.cssName(a))},cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}}})();
(function(){var d=jQuery,g=window.Popcorn,f={cssPrefix:"transcript",focusMs:750,fadeMs:1E3,opacity:1,timestamps:!1,breaks:!1};d.expr[":"].tx_contains=function(a,c,f){return 0<=d(a).text().toUpperCase().indexOf(f[3].toUpperCase())};var a=function(b,c,g){if(void 0==g&&(!c||!c.play))g=c,c=null;if("string"==typeof b&&a.instances[b])return b=a.instances[b],c&&c.play&&b.setPlayer(c),b;if(!(this instanceof a))return new a(b,c,g);this.target=b;this.setPlayer(c);this.config=d.extend(!0,{},f,g);this.init();
this.addListeners();a.instances[b]=this};a.instances={};MetaPlayer.Transcript=a;MetaPlayer.addPlugin("transcript",function(b,c){this.cues.enable("transcript",{target:b},{clone:"captions"});this.transcript=a(b,this.video,c)});a.prototype={init:function(){this.container=this.create();this.scroller=this.create("scroller");this._captions={};d(this.target).append(this.container);d(this.container).append(this.scroller);this.scrollbar=MetaPlayer.scrollbar(this.container)},addListeners:function(){var a=this;
this.container.bind("click touchstart",function(c){var f=d(c.target).parent("."+a.cssName("caption"));if(f.length&&(f=d(f).data("options")))a.player.currentTime=f.start,c.stopPropagation(),c.preventDefault()});this.container.bind("mouseenter touchstart",function(){a.mousing=!0});this.container.bind("mouseleave touchend",function(){a.mousing=!1})},setPlayer:function(a){if(!this.player){this.player=a;var c=this;d(this.player).bind("search",function(a){c.search(a.originalEvent.data)})}},search:function(a){"string"==
typeof a&&(a=a.split(/\s+/));var c=this.cssName("search");this.find("search").removeClass(c);var f=this;d.each(a,function(a,b){f.find("caption").find("."+f.cssName("text")+" span:tx_contains("+b+")").addClass(c)})},append:function(a){var c=this.create("caption",this.config.breaks?"div":"span");if(this.config.timestamps){var f=this.create("time","span");f.text(a.start+"s");c.append(f)}var g=this,k=d("<span></span>").addClass(this.cssName("text")).click(function(){g.player.currentTime=a.start}).appendTo(c),
f=a.text.split(/\s+/);d.each(f,function(a,b){d("<span></span>").text(b).appendTo(k);d(document.createTextNode(" ")).appendTo(k)});c.data("options",a);c.css("opacity",this.config.opacity);this.scroller.append(c);this._captions[a.start]=c},clear:function(){d(this.scroller).empty();this._captions={};this.scrollbar.render()},focus:function(a){a=this._captions[a.start];a.stop().animate({opacity:1},this.config.focusMs);a.toggleClass(this.cssName("focus"),!0);a=a.position().top-this.container.height()/2;
this.mousing||this.scrollbar.scrollTo(0,a,1E3)},blur:function(a){a=this._captions[a.start];a.stop().animate({opacity:this.config.opacity},this.config.fadeMs);a.toggleClass(this.cssName("focus"),!1)},find:function(a){return d(this.container).find("."+this.cssName(a))},create:function(a,c){c||(c="div");return d("<"+c+">").addClass(this.cssName(a))},cssName:function(a){return this.config.cssPrefix+(a?"-"+a:"")}};g&&g.plugin("transcript",{_setup:function(b){a(b.target,this.media).append(b)},start:function(b,
c){a(c.target).focus(c)},end:function(b,c){a(c.target).blur(c)},_teardown:function(b){a(b.target).clear()}})})();
